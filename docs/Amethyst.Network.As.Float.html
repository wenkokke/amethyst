<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Amethyst.Network.As.Float</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">--------------------------------------------------------------------------------</a>
<a id="82" class="Comment">-- Amethyst: Neural Network Verification in Agda</a>
<a id="131" class="Comment">--</a>
<a id="134" class="Comment">-- This module contains functions to evaluate neural networks as functions on</a>
<a id="212" class="Comment">-- vectors of floating-point numbers.</a>
<a id="250" class="Comment">--</a>
<a id="253" class="Comment">-- Exports:</a>
<a id="265" class="Comment">--</a>
<a id="268" class="Comment">--  - evalActivation</a>
<a id="289" class="Comment">--  - evalLayer</a>
<a id="305" class="Comment">--  - evalNetwork</a>
<a id="323" class="Comment">--</a>
<a id="326" class="Comment">--------------------------------------------------------------------------------</a>
<a id="407" class="Keyword">module</a> <a id="414" href="Amethyst.Network.As.Float.html" class="Module">Amethyst.Network.As.Float</a> <a id="440" class="Keyword">where</a>

<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="Amethyst.Network.Base.html" class="Module">Amethyst.Network.Base</a>
  <a id="483" class="Keyword">using</a> <a id="489" class="Symbol">(</a><a id="490" href="Amethyst.Network.Base.html#1285" class="Datatype">Network</a><a id="497" class="Symbol">;</a> <a id="499" href="Amethyst.Network.Base.html#1351" class="InductiveConstructor">[]</a><a id="501" class="Symbol">;</a> <a id="503" href="Amethyst.Network.Base.html#1386" class="InductiveConstructor Operator">_∷_</a><a id="506" class="Symbol">;</a> <a id="508" href="Amethyst.Network.Base.html#966" class="Record">Layer</a><a id="513" class="Symbol">;</a> <a id="515" href="Amethyst.Network.Base.html#820" class="Datatype">Activation</a><a id="525" class="Symbol">;</a> <a id="527" href="Amethyst.Network.Base.html#1127" class="Function">LayerSpec</a><a id="536" class="Symbol">;</a> <a id="538" href="Amethyst.Network.Base.html#1166" class="Function Operator">∣_₀∣</a><a id="542" class="Symbol">;</a> <a id="544" href="Amethyst.Network.Base.html#1216" class="Function Operator">∣_ₙ∣</a><a id="548" class="Symbol">)</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="Amethyst.Network.Approximation.html" class="Module">Amethyst.Network.Approximation</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Amethyst.LinearAlgebra.As.Float.html" class="Module">Amethyst.LinearAlgebra.As.Float</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Amethyst.PiecewiseLinear.As.Float.html" class="Module">Amethyst.PiecewiseLinear.As.Float</a>

<a id="684" class="Keyword">open</a> <a id="689" class="Keyword">import</a> <a id="696" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="706" class="Symbol">as</a> <a id="709" class="Module">Bool</a> <a id="714" class="Keyword">using</a> <a id="720" class="Symbol">(</a><a id="721" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="734" class="Symbol">)</a>
<a id="736" class="Keyword">open</a> <a id="741" class="Keyword">import</a> <a id="748" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="757" class="Symbol">as</a> <a id="760" class="Module">Fin</a> <a id="764" class="Keyword">using</a> <a id="770" class="Symbol">()</a>
<a id="773" class="Keyword">open</a> <a id="778" class="Keyword">import</a> <a id="785" href="Data.Float.html" class="Module">Data.Float</a> <a id="796" class="Symbol">as</a> <a id="799" class="Module">Float</a> <a id="805" class="Keyword">using</a> <a id="811" class="Symbol">(</a><a id="812" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="817" class="Symbol">;</a> <a id="819" href="Agda.Builtin.Float.html#422" class="Primitive">_≤ᵇ_</a><a id="823" class="Symbol">;</a> <a id="825" href="Agda.Builtin.Float.html#1336" class="Primitive">_+_</a><a id="828" class="Symbol">;</a> <a id="830" href="Agda.Builtin.Float.html#1389" class="Primitive">_-_</a><a id="833" class="Symbol">;</a> <a id="835" href="Agda.Builtin.Float.html#1442" class="Primitive">_*_</a><a id="838" class="Symbol">;</a> <a id="840" href="Agda.Builtin.Float.html#1495" class="Primitive">_÷_</a><a id="843" class="Symbol">;</a> <a id="845" href="Agda.Builtin.Float.html#1601" class="Primitive">-_</a><a id="847" class="Symbol">;</a> <a id="849" href="Agda.Builtin.Float.html#1691" class="Primitive">e^_</a><a id="852" class="Symbol">;</a> <a id="854" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a><a id="858" class="Symbol">)</a>
<a id="860" class="Keyword">open</a> <a id="865" class="Keyword">import</a> <a id="872" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="881" class="Symbol">as</a> <a id="884" class="Module">Nat</a> <a id="888" class="Keyword">using</a> <a id="894" class="Symbol">(</a><a id="895" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="896" class="Symbol">;</a> <a id="898" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="902" class="Symbol">;</a> <a id="904" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a><a id="907" class="Symbol">)</a>
<a id="909" class="Keyword">open</a> <a id="914" class="Keyword">import</a> <a id="921" href="Data.Product.html" class="Module">Data.Product</a> <a id="934" class="Keyword">using</a> <a id="940" class="Symbol">(</a><a id="941" href="Data.Product.html#3422" class="Function">uncurry</a><a id="948" class="Symbol">)</a>
<a id="950" class="Keyword">open</a> <a id="955" class="Keyword">import</a> <a id="962" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="971" class="Symbol">as</a> <a id="974" class="Module">Vec</a> <a id="978" class="Keyword">using</a> <a id="984" class="Symbol">(</a><a id="985" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="988" class="Symbol">)</a>
<a id="990" class="Keyword">open</a> <a id="995" class="Keyword">import</a> <a id="1002" href="Function.html" class="Module">Function</a> <a id="1011" class="Keyword">using</a> <a id="1017" class="Symbol">(</a><a id="1018" href="Function.Base.html#1031" class="Function Operator">_∘_</a><a id="1021" class="Symbol">;</a> <a id="1023" href="Function.Base.html#636" class="Function">const</a><a id="1028" class="Symbol">;</a> <a id="1030" href="Function.Base.html#615" class="Function">id</a><a id="1032" class="Symbol">)</a>

<a id="1035" class="Comment">-- * Activation functions</a>

<a id="1062" class="Keyword">private</a>
  <a id="1072" class="Keyword">variable</a>
    <a id="1085" href="Amethyst.Network.As.Float.html#1085" class="Generalizable">n</a> <a id="1087" class="Symbol">:</a> <a id="1089" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

  <a id="relu"></a><a id="1094" href="Amethyst.Network.As.Float.html#1094" class="Function">relu</a> <a id="1099" class="Symbol">:</a> <a id="1101" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1107" class="Symbol">→</a> <a id="1109" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="1117" href="Amethyst.Network.As.Float.html#1094" class="Function">relu</a> <a id="1122" href="Amethyst.Network.As.Float.html#1122" class="Bound">x</a> <a id="1124" class="Symbol">=</a> <a id="1126" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="1129" href="Amethyst.Network.As.Float.html#1122" class="Bound">x</a> <a id="1131" href="Agda.Builtin.Float.html#422" class="Primitive Operator">≤ᵇ</a> <a id="1134" class="Number">0.0</a> <a id="1138" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="1143" class="Number">0.0</a> <a id="1147" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="1152" href="Amethyst.Network.As.Float.html#1122" class="Bound">x</a>

  <a id="sigmoid"></a><a id="1157" href="Amethyst.Network.As.Float.html#1157" class="Function">sigmoid</a> <a id="1165" class="Symbol">:</a> <a id="1167" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1173" class="Symbol">→</a> <a id="1175" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="1183" href="Amethyst.Network.As.Float.html#1157" class="Function">sigmoid</a> <a id="1191" href="Amethyst.Network.As.Float.html#1191" class="Bound">x</a> <a id="1193" class="Symbol">=</a> <a id="1195" href="Amethyst.PiecewiseLinear.As.Float.html#2171" class="Function">eval</a> <a id="1200" href="Amethyst.Network.Approximation.html#1239" class="Function">sigmoidApprox</a> <a id="1214" href="Amethyst.Network.As.Float.html#1191" class="Bound">x</a>

  <a id="softmax"></a><a id="1219" href="Amethyst.Network.As.Float.html#1219" class="Function">softmax</a> <a id="1227" class="Symbol">:</a> <a id="1229" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1233" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1239" href="Amethyst.Network.As.Float.html#1085" class="Generalizable">n</a> <a id="1241" class="Symbol">→</a> <a id="1243" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1247" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1253" href="Amethyst.Network.As.Float.html#1085" class="Generalizable">n</a>
  <a id="1257" href="Amethyst.Network.As.Float.html#1219" class="Function">softmax</a> <a id="1265" href="Amethyst.Network.As.Float.html#1265" class="Bound">xs</a> <a id="1268" class="Symbol">=</a> <a id="1270" href="Amethyst.LinearAlgebra.As.Float.html#1314" class="Function">normalise</a> <a id="1280" class="Symbol">(</a><a id="1281" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1289" class="Symbol">(</a><a id="1290" href="Amethyst.PiecewiseLinear.As.Float.html#2171" class="Function">eval</a> <a id="1295" href="Amethyst.Network.Approximation.html#765" class="Function">expApprox</a><a id="1304" class="Symbol">)</a> <a id="1306" href="Amethyst.Network.As.Float.html#1265" class="Bound">xs</a><a id="1308" class="Symbol">)</a>

<a id="1311" class="Comment">-- * Neural networks</a>

<a id="1333" class="Keyword">private</a>
  <a id="1343" class="Keyword">variable</a>
    <a id="1356" href="Amethyst.Network.As.Float.html#1356" class="Generalizable">inputs</a>  <a id="1364" class="Symbol">:</a> <a id="1366" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="1372" href="Amethyst.Network.As.Float.html#1372" class="Generalizable">outputs</a> <a id="1380" class="Symbol">:</a> <a id="1382" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="1388" href="Amethyst.Network.As.Float.html#1388" class="Generalizable">layers</a>  <a id="1396" class="Symbol">:</a> <a id="1398" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  
<a id="1403" class="Comment">-- |Eval an activation function as a function on vectors of floats.</a>
<a id="evalActivation"></a><a id="1471" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1486" class="Symbol">:</a> <a id="1488" href="Amethyst.Network.Base.html#820" class="Datatype">Activation</a> <a id="1499" class="Symbol">→</a> <a id="1501" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1505" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1511" href="Amethyst.Network.As.Float.html#1085" class="Generalizable">n</a> <a id="1513" class="Symbol">→</a> <a id="1515" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1519" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1525" href="Amethyst.Network.As.Float.html#1085" class="Generalizable">n</a>
<a id="1527" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1542" href="Amethyst.Network.Base.html#845" class="InductiveConstructor">Activation.linear</a>  <a id="1561" class="Symbol">=</a> <a id="1563" href="Function.Base.html#615" class="Function">id</a>
<a id="1566" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1581" href="Amethyst.Network.Base.html#868" class="InductiveConstructor">Activation.relu</a>    <a id="1600" class="Symbol">=</a> <a id="1602" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1610" href="Amethyst.Network.As.Float.html#1094" class="Function">relu</a>
<a id="1615" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1630" href="Amethyst.Network.Base.html#891" class="InductiveConstructor">Activation.sigmoid</a> <a id="1649" class="Symbol">=</a> <a id="1651" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1659" href="Amethyst.Network.As.Float.html#1157" class="Function">sigmoid</a>
<a id="1667" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1682" href="Amethyst.Network.Base.html#914" class="InductiveConstructor">Activation.softmax</a> <a id="1701" class="Symbol">=</a> <a id="1703" href="Amethyst.Network.As.Float.html#1219" class="Function">softmax</a>
<a id="1711" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1726" href="Amethyst.Network.Base.html#937" class="InductiveConstructor">Activation.tanh</a>    <a id="1745" class="Symbol">=</a> <a id="1747" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1755" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a>

<a id="1761" class="Comment">-- |Eval a network layer as a function on vectors of floats.</a>
<a id="evalLayer"></a><a id="1822" href="Amethyst.Network.As.Float.html#1822" class="Function">evalLayer</a> <a id="1832" class="Symbol">:</a> <a id="1834" href="Amethyst.Network.Base.html#966" class="Record">Layer</a> <a id="1840" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1846" href="Amethyst.Network.As.Float.html#1356" class="Generalizable">inputs</a> <a id="1853" href="Amethyst.Network.As.Float.html#1372" class="Generalizable">outputs</a> <a id="1861" class="Symbol">→</a> <a id="1863" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1867" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1873" href="Amethyst.Network.As.Float.html#1356" class="Generalizable">inputs</a> <a id="1880" class="Symbol">→</a> <a id="1882" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1886" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1892" href="Amethyst.Network.As.Float.html#1372" class="Generalizable">outputs</a>
<a id="1900" href="Amethyst.Network.As.Float.html#1822" class="Function">evalLayer</a> <a id="1910" href="Amethyst.Network.As.Float.html#1910" class="Bound">l</a> <a id="1912" href="Amethyst.Network.As.Float.html#1912" class="Bound">xs</a> <a id="1915" class="Symbol">=</a> <a id="1917" href="Amethyst.Network.As.Float.html#1471" class="Function">evalActivation</a> <a id="1932" href="Amethyst.Network.Base.html#1027" class="Function">activation</a> <a id="1943" class="Symbol">(</a><a id="1944" href="Amethyst.Network.Base.html#1099" class="Function">biases</a> <a id="1951" href="Amethyst.LinearAlgebra.As.Float.html#949" class="Function Operator">⊕</a> <a id="1953" class="Symbol">(</a><a id="1954" href="Amethyst.Network.As.Float.html#1912" class="Bound">xs</a> <a id="1957" href="Amethyst.LinearAlgebra.As.Float.html#1501" class="Function Operator">v⊡m</a> <a id="1961" href="Amethyst.Network.Base.html#1055" class="Function">weights</a><a id="1968" class="Symbol">))</a>
  <a id="1973" class="Keyword">where</a>
    <a id="1983" class="Keyword">open</a> <a id="1988" href="Amethyst.Network.Base.html#966" class="Module">Layer</a> <a id="1994" href="Amethyst.Network.As.Float.html#1910" class="Bound">l</a> <a id="1996" class="Keyword">using</a> <a id="2002" class="Symbol">(</a><a id="2003" href="Amethyst.Network.Base.html#1027" class="Field">activation</a><a id="2013" class="Symbol">;</a> <a id="2015" href="Amethyst.Network.Base.html#1099" class="Field">biases</a><a id="2021" class="Symbol">;</a> <a id="2023" href="Amethyst.Network.Base.html#1055" class="Field">weights</a><a id="2030" class="Symbol">)</a>

<a id="2033" class="Comment">-- |Eval a network as a function on vectors of floats.</a>
<a id="evalNetwork"></a><a id="2088" href="Amethyst.Network.As.Float.html#2088" class="Function">evalNetwork</a> <a id="2100" class="Symbol">:</a> <a id="2102" class="Symbol">∀</a> <a id="2104" class="Symbol">{</a><a id="2105" href="Amethyst.Network.As.Float.html#2105" class="Bound">ls</a> <a id="2108" class="Symbol">:</a> <a id="2110" href="Amethyst.Network.Base.html#1127" class="Function">LayerSpec</a> <a id="2120" href="Amethyst.Network.As.Float.html#1388" class="Generalizable">layers</a><a id="2126" class="Symbol">}</a> <a id="2128" class="Symbol">→</a> <a id="2130" href="Amethyst.Network.Base.html#1285" class="Datatype">Network</a> <a id="2138" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="2144" href="Amethyst.Network.As.Float.html#2105" class="Bound">ls</a> <a id="2147" class="Symbol">→</a>
              <a id="2163" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="2167" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="2173" href="Amethyst.Network.Base.html#1166" class="Function Operator">∣</a> <a id="2175" href="Amethyst.Network.As.Float.html#2105" class="Bound">ls</a> <a id="2178" href="Amethyst.Network.Base.html#1166" class="Function Operator">₀∣</a> <a id="2181" class="Symbol">→</a> <a id="2183" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="2187" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="2193" href="Amethyst.Network.Base.html#1216" class="Function Operator">∣</a> <a id="2195" href="Amethyst.Network.As.Float.html#2105" class="Bound">ls</a> <a id="2198" href="Amethyst.Network.Base.html#1216" class="Function Operator">ₙ∣</a>
<a id="2201" href="Amethyst.Network.As.Float.html#2088" class="Function">evalNetwork</a> <a id="2213" href="Amethyst.Network.Base.html#1351" class="InductiveConstructor">[]</a>      <a id="2221" class="Symbol">=</a> <a id="2223" href="Function.Base.html#615" class="Function">id</a>
<a id="2226" href="Amethyst.Network.As.Float.html#2088" class="Function">evalNetwork</a> <a id="2238" class="Symbol">(</a><a id="2239" href="Amethyst.Network.As.Float.html#2239" class="Bound">l</a> <a id="2241" href="Amethyst.Network.Base.html#1386" class="InductiveConstructor Operator">∷</a> <a id="2243" href="Amethyst.Network.As.Float.html#2243" class="Bound">n</a><a id="2244" class="Symbol">)</a> <a id="2246" class="Symbol">=</a> <a id="2248" href="Amethyst.Network.As.Float.html#2088" class="Function">evalNetwork</a> <a id="2260" href="Amethyst.Network.As.Float.html#2243" class="Bound">n</a> <a id="2262" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="2264" href="Amethyst.Network.As.Float.html#1822" class="Function">evalLayer</a> <a id="2274" href="Amethyst.Network.As.Float.html#2239" class="Bound">l</a>
</pre></body></html>