<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Amethyst.Network.As.Float</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- This module contains functions to evaluate neural networks as functions on</a>
<a id="79" class="Comment">-- vectors of floating-point numbers.</a>
<a id="117" class="Comment">--</a>
<a id="120" class="Comment">-- Exports:</a>
<a id="132" class="Comment">--</a>
<a id="135" class="Comment">--  - evalActivation</a>
<a id="156" class="Comment">--  - evalLayer</a>
<a id="172" class="Comment">--  - evalNetwork</a>
<a id="190" class="Comment">--</a>
<a id="193" class="Keyword">module</a> <a id="200" href="Amethyst.Network.As.Float.html" class="Module">Amethyst.Network.As.Float</a> <a id="226" class="Keyword">where</a>

<a id="233" class="Keyword">open</a> <a id="238" class="Keyword">import</a> <a id="245" href="Amethyst.Network.html" class="Module">Amethyst.Network</a> <a id="262" class="Keyword">using</a> <a id="268" class="Symbol">(</a><a id="269" href="Amethyst.Network.html#677" class="Datatype">Network</a><a id="276" class="Symbol">;</a> <a id="278" href="Amethyst.Network.html#745" class="InductiveConstructor">[]</a><a id="280" class="Symbol">;</a> <a id="282" href="Amethyst.Network.html#779" class="InductiveConstructor Operator">_∷_</a><a id="285" class="Symbol">;</a> <a id="287" href="Amethyst.Network.html#497" class="Record">Layer</a><a id="292" class="Symbol">;</a> <a id="294" href="Amethyst.Network.html#351" class="Datatype">Activation</a><a id="304" class="Symbol">)</a>
<a id="306" class="Keyword">open</a> <a id="311" class="Keyword">import</a> <a id="318" href="Amethyst.LinearAlgebra.As.Float.html" class="Module">Amethyst.LinearAlgebra.As.Float</a>
<a id="350" class="Keyword">open</a> <a id="355" class="Keyword">import</a> <a id="362" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="372" class="Symbol">as</a> <a id="375" class="Module">Bool</a> <a id="380" class="Keyword">using</a> <a id="386" class="Symbol">(</a><a id="387" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="400" class="Symbol">)</a>
<a id="402" class="Keyword">open</a> <a id="407" class="Keyword">import</a> <a id="414" href="Data.Float.html" class="Module">Data.Float</a> <a id="425" class="Symbol">as</a> <a id="428" class="Module">Float</a> <a id="434" class="Keyword">using</a> <a id="440" class="Symbol">(</a><a id="441" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="446" class="Symbol">;</a> <a id="448" href="Agda.Builtin.Float.html#422" class="Primitive">_≤ᵇ_</a><a id="452" class="Symbol">;</a> <a id="454" href="Agda.Builtin.Float.html#1336" class="Primitive">_+_</a><a id="457" class="Symbol">;</a> <a id="459" href="Agda.Builtin.Float.html#1389" class="Primitive">_-_</a><a id="462" class="Symbol">;</a> <a id="464" href="Agda.Builtin.Float.html#1442" class="Primitive">_*_</a><a id="467" class="Symbol">;</a> <a id="469" href="Agda.Builtin.Float.html#1495" class="Primitive">_÷_</a><a id="472" class="Symbol">;</a> <a id="474" href="Agda.Builtin.Float.html#1601" class="Primitive">-_</a><a id="476" class="Symbol">;</a> <a id="478" href="Agda.Builtin.Float.html#1691" class="Primitive">e^_</a><a id="481" class="Symbol">;</a> <a id="483" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a><a id="487" class="Symbol">)</a>
<a id="489" class="Keyword">open</a> <a id="494" class="Keyword">import</a> <a id="501" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="510" class="Symbol">as</a> <a id="513" class="Module">Nat</a> <a id="517" class="Keyword">using</a> <a id="523" class="Symbol">(</a><a id="524" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="525" class="Symbol">)</a>
<a id="527" class="Keyword">open</a> <a id="532" class="Keyword">import</a> <a id="539" href="Data.Product.html" class="Module">Data.Product</a> <a id="552" class="Keyword">using</a> <a id="558" class="Symbol">(</a><a id="559" href="Data.Product.html#3399" class="Function">uncurry</a><a id="566" class="Symbol">)</a>
<a id="568" class="Keyword">open</a> <a id="573" class="Keyword">import</a> <a id="580" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="589" class="Symbol">as</a> <a id="592" class="Module">Vec</a> <a id="596" class="Keyword">using</a> <a id="602" class="Symbol">(</a><a id="603" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="606" class="Symbol">)</a>
<a id="608" class="Keyword">open</a> <a id="613" class="Keyword">import</a> <a id="620" href="Function.html" class="Module">Function</a> <a id="629" class="Keyword">using</a> <a id="635" class="Symbol">(</a><a id="636" href="Function.Base.html#1031" class="Function Operator">_∘_</a><a id="639" class="Symbol">;</a> <a id="641" href="Function.Base.html#636" class="Function">const</a><a id="646" class="Symbol">;</a> <a id="648" href="Function.Base.html#615" class="Function">id</a><a id="650" class="Symbol">)</a>

<a id="653" class="Comment">-- * Activation functions</a>

<a id="680" class="Keyword">private</a>
  <a id="690" class="Keyword">variable</a>
    <a id="703" href="Amethyst.Network.As.Float.html#703" class="Generalizable">n</a> <a id="705" class="Symbol">:</a> <a id="707" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

  <a id="relu"></a><a id="712" href="Amethyst.Network.As.Float.html#712" class="Function">relu</a> <a id="717" class="Symbol">:</a> <a id="719" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="725" class="Symbol">→</a> <a id="727" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="735" href="Amethyst.Network.As.Float.html#712" class="Function">relu</a> <a id="740" href="Amethyst.Network.As.Float.html#740" class="Bound">x</a> <a id="742" class="Symbol">=</a> <a id="744" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="747" href="Amethyst.Network.As.Float.html#740" class="Bound">x</a> <a id="749" href="Agda.Builtin.Float.html#422" class="Primitive Operator">≤ᵇ</a> <a id="752" class="Number">0.0</a> <a id="756" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="761" class="Number">0.0</a> <a id="765" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="770" href="Amethyst.Network.As.Float.html#740" class="Bound">x</a>

  <a id="sigmoid"></a><a id="775" href="Amethyst.Network.As.Float.html#775" class="Function">sigmoid</a> <a id="783" class="Symbol">:</a> <a id="785" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="791" class="Symbol">→</a> <a id="793" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="801" href="Amethyst.Network.As.Float.html#775" class="Function">sigmoid</a> <a id="809" href="Amethyst.Network.As.Float.html#809" class="Bound">x</a> <a id="811" class="Symbol">=</a> <a id="813" class="Number">1.0</a> <a id="817" href="Agda.Builtin.Float.html#1495" class="Primitive Operator">÷</a> <a id="819" class="Symbol">(</a><a id="820" class="Number">1.0</a> <a id="824" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="826" href="Agda.Builtin.Float.html#1691" class="Primitive Operator">e^</a> <a id="829" href="Agda.Builtin.Float.html#1601" class="Primitive Operator">-</a> <a id="831" href="Amethyst.Network.As.Float.html#809" class="Bound">x</a><a id="832" class="Symbol">)</a>

  <a id="softmax"></a><a id="837" href="Amethyst.Network.As.Float.html#837" class="Function">softmax</a> <a id="845" class="Symbol">:</a> <a id="847" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="851" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="857" href="Amethyst.Network.As.Float.html#703" class="Generalizable">n</a> <a id="859" class="Symbol">→</a> <a id="861" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="865" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="871" href="Amethyst.Network.As.Float.html#703" class="Generalizable">n</a>
  <a id="875" href="Amethyst.Network.As.Float.html#837" class="Function">softmax</a> <a id="883" href="Amethyst.Network.As.Float.html#883" class="Bound">xs</a> <a id="886" class="Symbol">=</a> <a id="888" href="Amethyst.LinearAlgebra.As.Float.html#980" class="Function">normalise</a> <a id="898" class="Symbol">(</a><a id="899" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="907" href="Agda.Builtin.Float.html#1691" class="Primitive Operator">e^_</a> <a id="911" href="Amethyst.Network.As.Float.html#883" class="Bound">xs</a><a id="913" class="Symbol">)</a>


<a id="917" class="Comment">-- * Neural networks</a>

<a id="939" class="Keyword">private</a>
  <a id="949" class="Keyword">variable</a>
    <a id="962" href="Amethyst.Network.As.Float.html#962" class="Generalizable">inputs</a>  <a id="970" class="Symbol">:</a> <a id="972" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="978" href="Amethyst.Network.As.Float.html#978" class="Generalizable">hidden</a>  <a id="986" class="Symbol">:</a> <a id="988" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="994" href="Amethyst.Network.As.Float.html#994" class="Generalizable">outputs</a> <a id="1002" class="Symbol">:</a> <a id="1004" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="1010" href="Amethyst.Network.As.Float.html#1010" class="Generalizable">layers</a>  <a id="1018" class="Symbol">:</a> <a id="1020" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="1023" class="Comment">-- |Eval an activation function as a function on vectors of floats.</a>
<a id="evalActivation"></a><a id="1091" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1106" class="Symbol">:</a> <a id="1108" href="Amethyst.Network.html#351" class="Datatype">Activation</a> <a id="1119" class="Symbol">→</a> <a id="1121" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1125" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1131" href="Amethyst.Network.As.Float.html#703" class="Generalizable">n</a> <a id="1133" class="Symbol">→</a> <a id="1135" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1139" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1145" href="Amethyst.Network.As.Float.html#703" class="Generalizable">n</a>
<a id="1147" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1162" href="Amethyst.Network.html#376" class="InductiveConstructor">Activation.linear</a>  <a id="1181" class="Symbol">=</a> <a id="1183" href="Function.Base.html#615" class="Function">id</a>
<a id="1186" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1201" href="Amethyst.Network.html#399" class="InductiveConstructor">Activation.relu</a>    <a id="1220" class="Symbol">=</a> <a id="1222" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1230" href="Amethyst.Network.As.Float.html#712" class="Function">relu</a>
<a id="1235" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1250" href="Amethyst.Network.html#422" class="InductiveConstructor">Activation.sigmoid</a> <a id="1269" class="Symbol">=</a> <a id="1271" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1279" href="Amethyst.Network.As.Float.html#775" class="Function">sigmoid</a>
<a id="1287" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1302" href="Amethyst.Network.html#445" class="InductiveConstructor">Activation.softmax</a> <a id="1321" class="Symbol">=</a> <a id="1323" href="Amethyst.Network.As.Float.html#837" class="Function">softmax</a>
<a id="1331" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1346" href="Amethyst.Network.html#468" class="InductiveConstructor">Activation.tanh</a>    <a id="1365" class="Symbol">=</a> <a id="1367" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1375" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a>

<a id="1381" class="Comment">-- |Eval a network layer as a function on vectors of floats.</a>
<a id="evalLayer"></a><a id="1442" href="Amethyst.Network.As.Float.html#1442" class="Function">evalLayer</a> <a id="1452" class="Symbol">:</a> <a id="1454" href="Amethyst.Network.html#497" class="Record">Layer</a> <a id="1460" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1466" href="Amethyst.Network.As.Float.html#962" class="Generalizable">inputs</a> <a id="1473" href="Amethyst.Network.As.Float.html#994" class="Generalizable">outputs</a> <a id="1481" class="Symbol">→</a> <a id="1483" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1487" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1493" href="Amethyst.Network.As.Float.html#962" class="Generalizable">inputs</a> <a id="1500" class="Symbol">→</a> <a id="1502" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1506" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1512" href="Amethyst.Network.As.Float.html#994" class="Generalizable">outputs</a>
<a id="1520" href="Amethyst.Network.As.Float.html#1442" class="Function">evalLayer</a> <a id="1530" href="Amethyst.Network.As.Float.html#1530" class="Bound">l</a> <a id="1532" href="Amethyst.Network.As.Float.html#1532" class="Bound">xs</a> <a id="1535" class="Symbol">=</a> <a id="1537" href="Amethyst.Network.As.Float.html#1091" class="Function">evalActivation</a> <a id="1552" href="Amethyst.Network.html#633" class="Function">activation</a> <a id="1563" class="Symbol">(</a><a id="1564" href="Amethyst.Network.html#602" class="Function">biases</a> <a id="1571" href="Amethyst.LinearAlgebra.As.Float.html#615" class="Function Operator">⊕</a> <a id="1573" class="Symbol">(</a><a id="1574" href="Amethyst.Network.As.Float.html#1532" class="Bound">xs</a> <a id="1577" href="Amethyst.LinearAlgebra.As.Float.html#1167" class="Function Operator">v⊡m</a> <a id="1581" href="Amethyst.Network.html#558" class="Function">weights</a><a id="1588" class="Symbol">))</a>
  <a id="1593" class="Keyword">where</a>
    <a id="1603" class="Keyword">open</a> <a id="1608" href="Amethyst.Network.html#497" class="Module">Layer</a> <a id="1614" href="Amethyst.Network.As.Float.html#1530" class="Bound">l</a> <a id="1616" class="Keyword">using</a> <a id="1622" class="Symbol">(</a><a id="1623" href="Amethyst.Network.html#633" class="Field">activation</a><a id="1633" class="Symbol">;</a> <a id="1635" href="Amethyst.Network.html#602" class="Field">biases</a><a id="1641" class="Symbol">;</a> <a id="1643" href="Amethyst.Network.html#558" class="Field">weights</a><a id="1650" class="Symbol">)</a>

<a id="1653" class="Comment">-- |Eval a network as a function on vectors of floats.</a>
<a id="evalNetwork"></a><a id="1708" href="Amethyst.Network.As.Float.html#1708" class="Function">evalNetwork</a> <a id="1720" class="Symbol">:</a> <a id="1722" href="Amethyst.Network.html#677" class="Datatype">Network</a> <a id="1730" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1736" href="Amethyst.Network.As.Float.html#962" class="Generalizable">inputs</a> <a id="1743" href="Amethyst.Network.As.Float.html#994" class="Generalizable">outputs</a> <a id="1751" href="Amethyst.Network.As.Float.html#1010" class="Generalizable">layers</a> <a id="1758" class="Symbol">→</a> <a id="1760" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1764" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1770" href="Amethyst.Network.As.Float.html#962" class="Generalizable">inputs</a> <a id="1777" class="Symbol">→</a> <a id="1779" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1783" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1789" href="Amethyst.Network.As.Float.html#994" class="Generalizable">outputs</a>
<a id="1797" href="Amethyst.Network.As.Float.html#1708" class="Function">evalNetwork</a> <a id="1809" href="Amethyst.Network.html#745" class="InductiveConstructor">[]</a>      <a id="1817" class="Symbol">=</a> <a id="1819" href="Function.Base.html#615" class="Function">id</a>
<a id="1822" href="Amethyst.Network.As.Float.html#1708" class="Function">evalNetwork</a> <a id="1834" class="Symbol">(</a><a id="1835" href="Amethyst.Network.As.Float.html#1835" class="Bound">l</a> <a id="1837" href="Amethyst.Network.html#779" class="InductiveConstructor Operator">∷</a> <a id="1839" href="Amethyst.Network.As.Float.html#1839" class="Bound">n</a><a id="1840" class="Symbol">)</a> <a id="1842" class="Symbol">=</a> <a id="1844" href="Amethyst.Network.As.Float.html#1708" class="Function">evalNetwork</a> <a id="1856" href="Amethyst.Network.As.Float.html#1839" class="Bound">n</a> <a id="1858" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1860" href="Amethyst.Network.As.Float.html#1442" class="Function">evalLayer</a> <a id="1870" href="Amethyst.Network.As.Float.html#1835" class="Bound">l</a>
</pre></body></html>