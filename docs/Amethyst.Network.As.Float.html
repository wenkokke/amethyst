<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Amethyst.Network.As.Float</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- This module contains functions to evaluate neural networks as functions on</a>
<a id="79" class="Comment">-- vectors of floating-point numbers.</a>
<a id="117" class="Comment">--</a>
<a id="120" class="Comment">-- Exports:</a>
<a id="132" class="Comment">--</a>
<a id="135" class="Comment">--  - evalActivation</a>
<a id="156" class="Comment">--  - evalLayer</a>
<a id="172" class="Comment">--  - evalNetwork</a>
<a id="190" class="Comment">--</a>
<a id="193" class="Keyword">module</a> <a id="200" href="Amethyst.Network.As.Float.html" class="Module">Amethyst.Network.As.Float</a> <a id="226" class="Keyword">where</a>

<a id="233" class="Keyword">open</a> <a id="238" class="Keyword">import</a> <a id="245" href="Amethyst.Network.Base.html" class="Module">Amethyst.Network.Base</a> <a id="267" class="Keyword">using</a> <a id="273" class="Symbol">(</a><a id="274" href="Amethyst.Network.Base.html#913" class="Datatype">Network</a><a id="281" class="Symbol">;</a> <a id="283" href="Amethyst.Network.Base.html#981" class="InductiveConstructor">[]</a><a id="285" class="Symbol">;</a> <a id="287" href="Amethyst.Network.Base.html#1015" class="InductiveConstructor Operator">_∷_</a><a id="290" class="Symbol">;</a> <a id="292" href="Amethyst.Network.Base.html#733" class="Record">Layer</a><a id="297" class="Symbol">;</a> <a id="299" href="Amethyst.Network.Base.html#587" class="Datatype">Activation</a><a id="309" class="Symbol">)</a>
<a id="311" class="Keyword">open</a> <a id="316" class="Keyword">import</a> <a id="323" href="Amethyst.LinearAlgebra.As.Float.html" class="Module">Amethyst.LinearAlgebra.As.Float</a>
<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="377" class="Symbol">as</a> <a id="380" class="Module">Bool</a> <a id="385" class="Keyword">using</a> <a id="391" class="Symbol">(</a><a id="392" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="405" class="Symbol">)</a>
<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Data.Float.html" class="Module">Data.Float</a> <a id="430" class="Symbol">as</a> <a id="433" class="Module">Float</a> <a id="439" class="Keyword">using</a> <a id="445" class="Symbol">(</a><a id="446" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="451" class="Symbol">;</a> <a id="453" href="Agda.Builtin.Float.html#422" class="Primitive">_≤ᵇ_</a><a id="457" class="Symbol">;</a> <a id="459" href="Agda.Builtin.Float.html#1336" class="Primitive">_+_</a><a id="462" class="Symbol">;</a> <a id="464" href="Agda.Builtin.Float.html#1389" class="Primitive">_-_</a><a id="467" class="Symbol">;</a> <a id="469" href="Agda.Builtin.Float.html#1442" class="Primitive">_*_</a><a id="472" class="Symbol">;</a> <a id="474" href="Agda.Builtin.Float.html#1495" class="Primitive">_÷_</a><a id="477" class="Symbol">;</a> <a id="479" href="Agda.Builtin.Float.html#1601" class="Primitive">-_</a><a id="481" class="Symbol">;</a> <a id="483" href="Agda.Builtin.Float.html#1691" class="Primitive">e^_</a><a id="486" class="Symbol">;</a> <a id="488" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a><a id="492" class="Symbol">)</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="515" class="Symbol">as</a> <a id="518" class="Module">Nat</a> <a id="522" class="Keyword">using</a> <a id="528" class="Symbol">(</a><a id="529" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="530" class="Symbol">)</a>
<a id="532" class="Keyword">open</a> <a id="537" class="Keyword">import</a> <a id="544" href="Data.Product.html" class="Module">Data.Product</a> <a id="557" class="Keyword">using</a> <a id="563" class="Symbol">(</a><a id="564" href="Data.Product.html#3399" class="Function">uncurry</a><a id="571" class="Symbol">)</a>
<a id="573" class="Keyword">open</a> <a id="578" class="Keyword">import</a> <a id="585" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="594" class="Symbol">as</a> <a id="597" class="Module">Vec</a> <a id="601" class="Keyword">using</a> <a id="607" class="Symbol">(</a><a id="608" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="611" class="Symbol">)</a>
<a id="613" class="Keyword">open</a> <a id="618" class="Keyword">import</a> <a id="625" href="Function.html" class="Module">Function</a> <a id="634" class="Keyword">using</a> <a id="640" class="Symbol">(</a><a id="641" href="Function.Base.html#1031" class="Function Operator">_∘_</a><a id="644" class="Symbol">;</a> <a id="646" href="Function.Base.html#636" class="Function">const</a><a id="651" class="Symbol">;</a> <a id="653" href="Function.Base.html#615" class="Function">id</a><a id="655" class="Symbol">)</a>

<a id="658" class="Comment">-- * Activation functions</a>

<a id="685" class="Keyword">private</a>
  <a id="695" class="Keyword">variable</a>
    <a id="708" href="Amethyst.Network.As.Float.html#708" class="Generalizable">n</a> <a id="710" class="Symbol">:</a> <a id="712" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

  <a id="relu"></a><a id="717" href="Amethyst.Network.As.Float.html#717" class="Function">relu</a> <a id="722" class="Symbol">:</a> <a id="724" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="730" class="Symbol">→</a> <a id="732" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="740" href="Amethyst.Network.As.Float.html#717" class="Function">relu</a> <a id="745" href="Amethyst.Network.As.Float.html#745" class="Bound">x</a> <a id="747" class="Symbol">=</a> <a id="749" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="752" href="Amethyst.Network.As.Float.html#745" class="Bound">x</a> <a id="754" href="Agda.Builtin.Float.html#422" class="Primitive Operator">≤ᵇ</a> <a id="757" class="Number">0.0</a> <a id="761" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="766" class="Number">0.0</a> <a id="770" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="775" href="Amethyst.Network.As.Float.html#745" class="Bound">x</a>

  <a id="sigmoid"></a><a id="780" href="Amethyst.Network.As.Float.html#780" class="Function">sigmoid</a> <a id="788" class="Symbol">:</a> <a id="790" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="796" class="Symbol">→</a> <a id="798" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="806" href="Amethyst.Network.As.Float.html#780" class="Function">sigmoid</a> <a id="814" href="Amethyst.Network.As.Float.html#814" class="Bound">x</a> <a id="816" class="Symbol">=</a> <a id="818" class="Number">1.0</a> <a id="822" href="Agda.Builtin.Float.html#1495" class="Primitive Operator">÷</a> <a id="824" class="Symbol">(</a><a id="825" class="Number">1.0</a> <a id="829" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="831" href="Agda.Builtin.Float.html#1691" class="Primitive Operator">e^</a> <a id="834" href="Agda.Builtin.Float.html#1601" class="Primitive Operator">-</a> <a id="836" href="Amethyst.Network.As.Float.html#814" class="Bound">x</a><a id="837" class="Symbol">)</a>

  <a id="softmax"></a><a id="842" href="Amethyst.Network.As.Float.html#842" class="Function">softmax</a> <a id="850" class="Symbol">:</a> <a id="852" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="856" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="862" href="Amethyst.Network.As.Float.html#708" class="Generalizable">n</a> <a id="864" class="Symbol">→</a> <a id="866" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="870" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="876" href="Amethyst.Network.As.Float.html#708" class="Generalizable">n</a>
  <a id="880" href="Amethyst.Network.As.Float.html#842" class="Function">softmax</a> <a id="888" href="Amethyst.Network.As.Float.html#888" class="Bound">xs</a> <a id="891" class="Symbol">=</a> <a id="893" href="Amethyst.LinearAlgebra.As.Float.html#892" class="Function">normalise</a> <a id="903" class="Symbol">(</a><a id="904" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="912" href="Agda.Builtin.Float.html#1691" class="Primitive Operator">e^_</a> <a id="916" href="Amethyst.Network.As.Float.html#888" class="Bound">xs</a><a id="918" class="Symbol">)</a>


<a id="922" class="Comment">-- * Neural networks</a>

<a id="944" class="Keyword">private</a>
  <a id="954" class="Keyword">variable</a>
    <a id="967" href="Amethyst.Network.As.Float.html#967" class="Generalizable">inputs</a>  <a id="975" class="Symbol">:</a> <a id="977" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="983" href="Amethyst.Network.As.Float.html#983" class="Generalizable">hidden</a>  <a id="991" class="Symbol">:</a> <a id="993" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="999" href="Amethyst.Network.As.Float.html#999" class="Generalizable">outputs</a> <a id="1007" class="Symbol">:</a> <a id="1009" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="1015" href="Amethyst.Network.As.Float.html#1015" class="Generalizable">layers</a>  <a id="1023" class="Symbol">:</a> <a id="1025" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="1028" class="Comment">-- |Eval an activation function as a function on vectors of floats.</a>
<a id="evalActivation"></a><a id="1096" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1111" class="Symbol">:</a> <a id="1113" href="Amethyst.Network.Base.html#587" class="Datatype">Activation</a> <a id="1124" class="Symbol">→</a> <a id="1126" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1130" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1136" href="Amethyst.Network.As.Float.html#708" class="Generalizable">n</a> <a id="1138" class="Symbol">→</a> <a id="1140" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1144" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1150" href="Amethyst.Network.As.Float.html#708" class="Generalizable">n</a>
<a id="1152" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1167" href="Amethyst.Network.Base.html#612" class="InductiveConstructor">Activation.linear</a>  <a id="1186" class="Symbol">=</a> <a id="1188" href="Function.Base.html#615" class="Function">id</a>
<a id="1191" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1206" href="Amethyst.Network.Base.html#635" class="InductiveConstructor">Activation.relu</a>    <a id="1225" class="Symbol">=</a> <a id="1227" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1235" href="Amethyst.Network.As.Float.html#717" class="Function">relu</a>
<a id="1240" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1255" href="Amethyst.Network.Base.html#658" class="InductiveConstructor">Activation.sigmoid</a> <a id="1274" class="Symbol">=</a> <a id="1276" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1284" href="Amethyst.Network.As.Float.html#780" class="Function">sigmoid</a>
<a id="1292" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1307" href="Amethyst.Network.Base.html#681" class="InductiveConstructor">Activation.softmax</a> <a id="1326" class="Symbol">=</a> <a id="1328" href="Amethyst.Network.As.Float.html#842" class="Function">softmax</a>
<a id="1336" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1351" href="Amethyst.Network.Base.html#704" class="InductiveConstructor">Activation.tanh</a>    <a id="1370" class="Symbol">=</a> <a id="1372" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1380" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a>

<a id="1386" class="Comment">-- |Eval a network layer as a function on vectors of floats.</a>
<a id="evalLayer"></a><a id="1447" href="Amethyst.Network.As.Float.html#1447" class="Function">evalLayer</a> <a id="1457" class="Symbol">:</a> <a id="1459" href="Amethyst.Network.Base.html#733" class="Record">Layer</a> <a id="1465" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1471" href="Amethyst.Network.As.Float.html#967" class="Generalizable">inputs</a> <a id="1478" href="Amethyst.Network.As.Float.html#999" class="Generalizable">outputs</a> <a id="1486" class="Symbol">→</a> <a id="1488" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1492" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1498" href="Amethyst.Network.As.Float.html#967" class="Generalizable">inputs</a> <a id="1505" class="Symbol">→</a> <a id="1507" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1511" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1517" href="Amethyst.Network.As.Float.html#999" class="Generalizable">outputs</a>
<a id="1525" href="Amethyst.Network.As.Float.html#1447" class="Function">evalLayer</a> <a id="1535" href="Amethyst.Network.As.Float.html#1535" class="Bound">l</a> <a id="1537" href="Amethyst.Network.As.Float.html#1537" class="Bound">xs</a> <a id="1540" class="Symbol">=</a> <a id="1542" href="Amethyst.Network.As.Float.html#1096" class="Function">evalActivation</a> <a id="1557" href="Amethyst.Network.Base.html#794" class="Function">activation</a> <a id="1568" class="Symbol">(</a><a id="1569" href="Amethyst.Network.Base.html#866" class="Function">biases</a> <a id="1576" href="Amethyst.LinearAlgebra.As.Float.html#527" class="Function Operator">⊕</a> <a id="1578" class="Symbol">(</a><a id="1579" href="Amethyst.Network.As.Float.html#1537" class="Bound">xs</a> <a id="1582" href="Amethyst.LinearAlgebra.As.Float.html#1079" class="Function Operator">v⊡m</a> <a id="1586" href="Amethyst.Network.Base.html#822" class="Function">weights</a><a id="1593" class="Symbol">))</a>
  <a id="1598" class="Keyword">where</a>
    <a id="1608" class="Keyword">open</a> <a id="1613" href="Amethyst.Network.Base.html#733" class="Module">Layer</a> <a id="1619" href="Amethyst.Network.As.Float.html#1535" class="Bound">l</a> <a id="1621" class="Keyword">using</a> <a id="1627" class="Symbol">(</a><a id="1628" href="Amethyst.Network.Base.html#794" class="Field">activation</a><a id="1638" class="Symbol">;</a> <a id="1640" href="Amethyst.Network.Base.html#866" class="Field">biases</a><a id="1646" class="Symbol">;</a> <a id="1648" href="Amethyst.Network.Base.html#822" class="Field">weights</a><a id="1655" class="Symbol">)</a>

<a id="1658" class="Comment">-- |Eval a network as a function on vectors of floats.</a>
<a id="evalNetwork"></a><a id="1713" href="Amethyst.Network.As.Float.html#1713" class="Function">evalNetwork</a> <a id="1725" class="Symbol">:</a> <a id="1727" href="Amethyst.Network.Base.html#913" class="Datatype">Network</a> <a id="1735" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1741" href="Amethyst.Network.As.Float.html#967" class="Generalizable">inputs</a> <a id="1748" href="Amethyst.Network.As.Float.html#999" class="Generalizable">outputs</a> <a id="1756" href="Amethyst.Network.As.Float.html#1015" class="Generalizable">layers</a> <a id="1763" class="Symbol">→</a> <a id="1765" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1769" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1775" href="Amethyst.Network.As.Float.html#967" class="Generalizable">inputs</a> <a id="1782" class="Symbol">→</a> <a id="1784" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1788" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1794" href="Amethyst.Network.As.Float.html#999" class="Generalizable">outputs</a>
<a id="1802" href="Amethyst.Network.As.Float.html#1713" class="Function">evalNetwork</a> <a id="1814" href="Amethyst.Network.Base.html#981" class="InductiveConstructor">[]</a>      <a id="1822" class="Symbol">=</a> <a id="1824" href="Function.Base.html#615" class="Function">id</a>
<a id="1827" href="Amethyst.Network.As.Float.html#1713" class="Function">evalNetwork</a> <a id="1839" class="Symbol">(</a><a id="1840" href="Amethyst.Network.As.Float.html#1840" class="Bound">l</a> <a id="1842" href="Amethyst.Network.Base.html#1015" class="InductiveConstructor Operator">∷</a> <a id="1844" href="Amethyst.Network.As.Float.html#1844" class="Bound">n</a><a id="1845" class="Symbol">)</a> <a id="1847" class="Symbol">=</a> <a id="1849" href="Amethyst.Network.As.Float.html#1713" class="Function">evalNetwork</a> <a id="1861" href="Amethyst.Network.As.Float.html#1844" class="Bound">n</a> <a id="1863" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1865" href="Amethyst.Network.As.Float.html#1447" class="Function">evalLayer</a> <a id="1875" href="Amethyst.Network.As.Float.html#1840" class="Bound">l</a>
</pre></body></html>