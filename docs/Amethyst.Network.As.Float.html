<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Amethyst.Network.As.Float</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">--------------------------------------------------------------------------------</a>
<a id="82" class="Comment">-- Amethyst: Neural Network Verification in Agda</a>
<a id="131" class="Comment">--</a>
<a id="134" class="Comment">-- This module contains functions to evaluate neural networks as functions on</a>
<a id="212" class="Comment">-- vectors of floating-point numbers.</a>
<a id="250" class="Comment">--</a>
<a id="253" class="Comment">-- Exports:</a>
<a id="265" class="Comment">--</a>
<a id="268" class="Comment">--  - evalActivation</a>
<a id="289" class="Comment">--  - evalLayer</a>
<a id="305" class="Comment">--  - evalNetwork</a>
<a id="323" class="Comment">--</a>
<a id="326" class="Comment">--------------------------------------------------------------------------------</a>
<a id="407" class="Keyword">module</a> <a id="414" href="Amethyst.Network.As.Float.html" class="Module">Amethyst.Network.As.Float</a> <a id="440" class="Keyword">where</a>

<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="Amethyst.Network.Base.html" class="Module">Amethyst.Network.Base</a>
  <a id="483" class="Keyword">using</a> <a id="489" class="Symbol">(</a><a id="490" href="Amethyst.Network.Base.html#1287" class="Datatype">Network</a><a id="497" class="Symbol">;</a> <a id="499" href="Amethyst.Network.Base.html#1353" class="InductiveConstructor">[]</a><a id="501" class="Symbol">;</a> <a id="503" href="Amethyst.Network.Base.html#1388" class="InductiveConstructor Operator">_∷_</a><a id="506" class="Symbol">;</a> <a id="508" href="Amethyst.Network.Base.html#969" class="Record">Layer</a><a id="513" class="Symbol">;</a> <a id="515" href="Amethyst.Network.Base.html#823" class="Datatype">Activation</a><a id="525" class="Symbol">;</a> <a id="527" href="Amethyst.Network.Base.html#1130" class="Function">LayerSpec</a><a id="536" class="Symbol">;</a> <a id="538" href="Amethyst.Network.Base.html#1169" class="Function Operator">∣_₀∣</a><a id="542" class="Symbol">;</a> <a id="544" href="Amethyst.Network.Base.html#1219" class="Function Operator">∣_ₙ∣</a><a id="548" class="Symbol">)</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="Amethyst.Network.Approximation.html" class="Module">Amethyst.Network.Approximation</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Amethyst.LinearAlgebra.As.Float.html" class="Module">Amethyst.LinearAlgebra.As.Float</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Amethyst.PiecewiseLinear.As.Float.html" class="Module">Amethyst.PiecewiseLinear.As.Float</a>
<a id="683" class="Keyword">import</a> <a id="690" href="Amethyst.Data.Vec.html" class="Module">Amethyst.Data.Vec</a> <a id="708" class="Symbol">as</a> <a id="711" class="Module">Vec</a>

<a id="716" class="Keyword">open</a> <a id="721" class="Keyword">import</a> <a id="728" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="738" class="Symbol">as</a> <a id="741" class="Module">Bool</a> <a id="746" class="Keyword">using</a> <a id="752" class="Symbol">(</a><a id="753" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="766" class="Symbol">)</a>
<a id="768" class="Keyword">open</a> <a id="773" class="Keyword">import</a> <a id="780" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="789" class="Symbol">as</a> <a id="792" class="Module">Fin</a> <a id="796" class="Keyword">using</a> <a id="802" class="Symbol">()</a>
<a id="805" class="Keyword">open</a> <a id="810" class="Keyword">import</a> <a id="817" href="Data.Float.html" class="Module">Data.Float</a> <a id="828" class="Symbol">as</a> <a id="831" class="Module">Float</a> <a id="837" class="Keyword">using</a> <a id="843" class="Symbol">(</a><a id="844" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="849" class="Symbol">;</a> <a id="851" href="Agda.Builtin.Float.html#422" class="Primitive">_≤ᵇ_</a><a id="855" class="Symbol">;</a> <a id="857" href="Agda.Builtin.Float.html#1336" class="Primitive">_+_</a><a id="860" class="Symbol">;</a> <a id="862" href="Agda.Builtin.Float.html#1389" class="Primitive">_-_</a><a id="865" class="Symbol">;</a> <a id="867" href="Agda.Builtin.Float.html#1442" class="Primitive">_*_</a><a id="870" class="Symbol">;</a> <a id="872" href="Agda.Builtin.Float.html#1495" class="Primitive">_÷_</a><a id="875" class="Symbol">;</a> <a id="877" href="Agda.Builtin.Float.html#1601" class="Primitive">-_</a><a id="879" class="Symbol">;</a> <a id="881" href="Agda.Builtin.Float.html#1691" class="Primitive">e^_</a><a id="884" class="Symbol">;</a> <a id="886" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a><a id="890" class="Symbol">)</a>
<a id="892" class="Keyword">open</a> <a id="897" class="Keyword">import</a> <a id="904" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="913" class="Symbol">as</a> <a id="916" class="Module">Nat</a> <a id="920" class="Keyword">using</a> <a id="926" class="Symbol">(</a><a id="927" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="928" class="Symbol">;</a> <a id="930" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="934" class="Symbol">;</a> <a id="936" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a><a id="939" class="Symbol">)</a>
<a id="941" class="Keyword">open</a> <a id="946" class="Keyword">import</a> <a id="953" href="Data.Product.html" class="Module">Data.Product</a> <a id="966" class="Keyword">using</a> <a id="972" class="Symbol">(</a><a id="973" href="Data.Product.html#3422" class="Function">uncurry</a><a id="980" class="Symbol">)</a>
<a id="982" class="Keyword">open</a> <a id="987" class="Keyword">import</a> <a id="994" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="1003" class="Symbol">as</a> <a id="1006" class="Module">Vec</a> <a id="1010" class="Keyword">using</a> <a id="1016" class="Symbol">(</a><a id="1017" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="1020" class="Symbol">)</a>
<a id="1022" class="Keyword">open</a> <a id="1027" class="Keyword">import</a> <a id="1034" href="Function.html" class="Module">Function</a> <a id="1043" class="Keyword">using</a> <a id="1049" class="Symbol">(</a><a id="1050" href="Function.Base.html#1031" class="Function Operator">_∘_</a><a id="1053" class="Symbol">;</a> <a id="1055" href="Function.Base.html#636" class="Function">const</a><a id="1060" class="Symbol">;</a> <a id="1062" href="Function.Base.html#615" class="Function">id</a><a id="1064" class="Symbol">)</a>

<a id="1067" class="Comment">-- * Activation functions</a>

<a id="1094" class="Keyword">private</a>
  <a id="1104" class="Keyword">variable</a>
    <a id="1117" href="Amethyst.Network.As.Float.html#1117" class="Generalizable">n</a> <a id="1119" class="Symbol">:</a> <a id="1121" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

  <a id="relu"></a><a id="1126" href="Amethyst.Network.As.Float.html#1126" class="Function">relu</a> <a id="1131" class="Symbol">:</a> <a id="1133" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1139" class="Symbol">→</a> <a id="1141" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="1149" href="Amethyst.Network.As.Float.html#1126" class="Function">relu</a> <a id="1154" href="Amethyst.Network.As.Float.html#1154" class="Bound">x</a> <a id="1156" class="Symbol">=</a> <a id="1158" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="1161" href="Amethyst.Network.As.Float.html#1154" class="Bound">x</a> <a id="1163" href="Agda.Builtin.Float.html#422" class="Primitive Operator">≤ᵇ</a> <a id="1166" class="Number">0.0</a> <a id="1170" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="1175" class="Number">0.0</a> <a id="1179" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="1184" href="Amethyst.Network.As.Float.html#1154" class="Bound">x</a>

  <a id="sigmoid"></a><a id="1189" href="Amethyst.Network.As.Float.html#1189" class="Function">sigmoid</a> <a id="1197" class="Symbol">:</a> <a id="1199" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1205" class="Symbol">→</a> <a id="1207" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
  <a id="1215" href="Amethyst.Network.As.Float.html#1189" class="Function">sigmoid</a> <a id="1223" href="Amethyst.Network.As.Float.html#1223" class="Bound">x</a> <a id="1225" class="Symbol">=</a> <a id="1227" href="Amethyst.PiecewiseLinear.As.Float.html#2171" class="Function">eval</a> <a id="1232" href="Amethyst.Network.Approximation.html#1239" class="Function">sigmoidApprox</a> <a id="1246" href="Amethyst.Network.As.Float.html#1223" class="Bound">x</a>

  <a id="softmax"></a><a id="1251" href="Amethyst.Network.As.Float.html#1251" class="Function">softmax</a> <a id="1259" class="Symbol">:</a> <a id="1261" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1265" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1271" href="Amethyst.Network.As.Float.html#1117" class="Generalizable">n</a> <a id="1273" class="Symbol">→</a> <a id="1275" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1279" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1285" href="Amethyst.Network.As.Float.html#1117" class="Generalizable">n</a>
  <a id="1289" href="Amethyst.Network.As.Float.html#1251" class="Function">softmax</a> <a id="1297" href="Amethyst.Network.As.Float.html#1297" class="Bound">xs</a> <a id="1300" class="Symbol">=</a> <a id="1302" href="Amethyst.LinearAlgebra.As.Float.html#1314" class="Function">normalise</a> <a id="1312" class="Symbol">(</a><a id="1313" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1321" class="Symbol">(</a><a id="1322" href="Amethyst.PiecewiseLinear.As.Float.html#2171" class="Function">eval</a> <a id="1327" href="Amethyst.Network.Approximation.html#765" class="Function">expApprox</a><a id="1336" class="Symbol">)</a> <a id="1338" href="Amethyst.Network.As.Float.html#1297" class="Bound">xs</a><a id="1340" class="Symbol">)</a>

<a id="1343" class="Comment">-- * Neural networks</a>

<a id="1365" class="Keyword">private</a>
  <a id="1375" class="Keyword">variable</a>
    <a id="1388" href="Amethyst.Network.As.Float.html#1388" class="Generalizable">inputs</a>  <a id="1396" class="Symbol">:</a> <a id="1398" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="1404" href="Amethyst.Network.As.Float.html#1404" class="Generalizable">outputs</a> <a id="1412" class="Symbol">:</a> <a id="1414" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="1420" href="Amethyst.Network.As.Float.html#1420" class="Generalizable">layers</a>  <a id="1428" class="Symbol">:</a> <a id="1430" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  
<a id="1435" class="Comment">-- |Eval an activation function as a function on vectors of floats.</a>
<a id="evalActivation"></a><a id="1503" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1518" class="Symbol">:</a> <a id="1520" href="Amethyst.Network.Base.html#823" class="Datatype">Activation</a> <a id="1531" class="Symbol">→</a> <a id="1533" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1537" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1543" href="Amethyst.Network.As.Float.html#1117" class="Generalizable">n</a> <a id="1545" class="Symbol">→</a> <a id="1547" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1551" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1557" href="Amethyst.Network.As.Float.html#1117" class="Generalizable">n</a>
<a id="1559" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1574" href="Amethyst.Network.Base.html#848" class="InductiveConstructor">Activation.linear</a>  <a id="1593" class="Symbol">=</a> <a id="1595" href="Function.Base.html#615" class="Function">id</a>
<a id="1598" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1613" href="Amethyst.Network.Base.html#871" class="InductiveConstructor">Activation.relu</a>    <a id="1632" class="Symbol">=</a> <a id="1634" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1642" href="Amethyst.Network.As.Float.html#1126" class="Function">relu</a>
<a id="1647" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1662" href="Amethyst.Network.Base.html#894" class="InductiveConstructor">Activation.sigmoid</a> <a id="1681" class="Symbol">=</a> <a id="1683" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1691" href="Amethyst.Network.As.Float.html#1189" class="Function">sigmoid</a>
<a id="1699" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1714" href="Amethyst.Network.Base.html#917" class="InductiveConstructor">Activation.softmax</a> <a id="1733" class="Symbol">=</a> <a id="1735" href="Amethyst.Network.As.Float.html#1251" class="Function">softmax</a>
<a id="1743" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1758" href="Amethyst.Network.Base.html#940" class="InductiveConstructor">Activation.tanh</a>    <a id="1777" class="Symbol">=</a> <a id="1779" href="Data.Vec.Base.html#2541" class="Function">Vec.map</a> <a id="1787" href="Agda.Builtin.Float.html#2194" class="Primitive">tanh</a>

<a id="1793" class="Comment">-- |Eval a network layer as a function on vectors of floats.</a>
<a id="evalLayer"></a><a id="1854" href="Amethyst.Network.As.Float.html#1854" class="Function">evalLayer</a> <a id="1864" class="Symbol">:</a> <a id="1866" href="Amethyst.Network.Base.html#969" class="Record">Layer</a> <a id="1872" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1878" href="Amethyst.Network.As.Float.html#1388" class="Generalizable">inputs</a> <a id="1885" href="Amethyst.Network.As.Float.html#1404" class="Generalizable">outputs</a> <a id="1893" class="Symbol">→</a> <a id="1895" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1899" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1905" href="Amethyst.Network.As.Float.html#1388" class="Generalizable">inputs</a> <a id="1912" class="Symbol">→</a> <a id="1914" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1918" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="1924" href="Amethyst.Network.As.Float.html#1404" class="Generalizable">outputs</a>
<a id="1932" href="Amethyst.Network.As.Float.html#1854" class="Function">evalLayer</a> <a id="1942" href="Amethyst.Network.As.Float.html#1942" class="Bound">l</a> <a id="1944" href="Amethyst.Network.As.Float.html#1944" class="Bound">xs</a> <a id="1947" class="Symbol">=</a> <a id="1949" href="Amethyst.Network.As.Float.html#1503" class="Function">evalActivation</a> <a id="1964" href="Amethyst.Network.Base.html#1030" class="Function">activation</a> <a id="1975" class="Symbol">(</a><a id="1976" href="Amethyst.Network.Base.html#1102" class="Function">biases</a> <a id="1983" href="Amethyst.LinearAlgebra.As.Float.html#949" class="Function Operator">⊕</a> <a id="1985" class="Symbol">(</a><a id="1986" href="Amethyst.Network.As.Float.html#1944" class="Bound">xs</a> <a id="1989" href="Amethyst.LinearAlgebra.As.Float.html#1501" class="Function Operator">v⊡m</a> <a id="1993" href="Amethyst.Network.Base.html#1058" class="Function">weights</a><a id="2000" class="Symbol">))</a>
  <a id="2005" class="Keyword">where</a>
    <a id="2015" class="Keyword">open</a> <a id="2020" href="Amethyst.Network.Base.html#969" class="Module">Layer</a> <a id="2026" href="Amethyst.Network.As.Float.html#1942" class="Bound">l</a> <a id="2028" class="Keyword">using</a> <a id="2034" class="Symbol">(</a><a id="2035" href="Amethyst.Network.Base.html#1030" class="Field">activation</a><a id="2045" class="Symbol">;</a> <a id="2047" href="Amethyst.Network.Base.html#1102" class="Field">biases</a><a id="2053" class="Symbol">;</a> <a id="2055" href="Amethyst.Network.Base.html#1058" class="Field">weights</a><a id="2062" class="Symbol">)</a>

<a id="2065" class="Comment">-- |Eval a network as a function on vectors of floats.</a>
<a id="evalNetwork"></a><a id="2120" href="Amethyst.Network.As.Float.html#2120" class="Function">evalNetwork</a> <a id="2132" class="Symbol">:</a> <a id="2134" class="Symbol">∀</a> <a id="2136" class="Symbol">{</a><a id="2137" href="Amethyst.Network.As.Float.html#2137" class="Bound">ls</a> <a id="2140" class="Symbol">:</a> <a id="2142" href="Amethyst.Network.Base.html#1130" class="Function">LayerSpec</a> <a id="2152" href="Amethyst.Network.As.Float.html#1420" class="Generalizable">layers</a><a id="2158" class="Symbol">}</a> <a id="2160" class="Symbol">→</a> <a id="2162" href="Amethyst.Network.Base.html#1287" class="Datatype">Network</a> <a id="2170" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="2176" href="Amethyst.Network.As.Float.html#2137" class="Bound">ls</a> <a id="2179" class="Symbol">→</a>
              <a id="2195" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="2199" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="2205" href="Amethyst.Network.Base.html#1169" class="Function Operator">∣</a> <a id="2207" href="Amethyst.Network.As.Float.html#2137" class="Bound">ls</a> <a id="2210" href="Amethyst.Network.Base.html#1169" class="Function Operator">₀∣</a> <a id="2213" class="Symbol">→</a> <a id="2215" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="2219" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="2225" href="Amethyst.Network.Base.html#1219" class="Function Operator">∣</a> <a id="2227" href="Amethyst.Network.As.Float.html#2137" class="Bound">ls</a> <a id="2230" href="Amethyst.Network.Base.html#1219" class="Function Operator">ₙ∣</a>
<a id="2233" href="Amethyst.Network.As.Float.html#2120" class="Function">evalNetwork</a> <a id="2245" href="Amethyst.Network.Base.html#1353" class="InductiveConstructor">[]</a>      <a id="2253" class="Symbol">=</a> <a id="2255" href="Function.Base.html#615" class="Function">id</a>
<a id="2258" href="Amethyst.Network.As.Float.html#2120" class="Function">evalNetwork</a> <a id="2270" class="Symbol">(</a><a id="2271" href="Amethyst.Network.As.Float.html#2271" class="Bound">l</a> <a id="2273" href="Amethyst.Network.Base.html#1388" class="InductiveConstructor Operator">∷</a> <a id="2275" href="Amethyst.Network.As.Float.html#2275" class="Bound">n</a><a id="2276" class="Symbol">)</a> <a id="2278" class="Symbol">=</a> <a id="2280" href="Amethyst.Network.As.Float.html#2120" class="Function">evalNetwork</a> <a id="2292" href="Amethyst.Network.As.Float.html#2275" class="Bound">n</a> <a id="2294" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="2296" href="Amethyst.Network.As.Float.html#1854" class="Function">evalLayer</a> <a id="2306" href="Amethyst.Network.As.Float.html#2271" class="Bound">l</a>
</pre></body></html>