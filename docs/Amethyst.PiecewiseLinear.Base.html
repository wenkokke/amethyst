<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Amethyst.PiecewiseLinear.Base</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">--------------------------------------------------------------------------------</a>
<a id="82" class="Comment">-- Amethyst: Neural Network Verification in Agda</a>
<a id="131" class="Comment">--</a>
<a id="134" class="Comment">-- This module contains an implementation of naive linearisation, which</a>
<a id="206" class="Comment">-- approximates non-linear functions using piecewise-linear approximations,</a>
<a id="282" class="Comment">-- i.e., with a sequence of connected line segments.</a>
<a id="335" class="Comment">-- The function `linearise` approximates a function `f : Float →  Float` over</a>
<a id="413" class="Comment">-- an interval `(lower, upper)` using `pieces` line segments:</a>
<a id="475" class="Comment">--</a>
<a id="478" class="Comment">--   1. We compute a step size `step` which divides the interval `(lower,</a>
<a id="552" class="Comment">--      upper)` into `pieces` subintervals of size `step`.</a>
<a id="611" class="Comment">--   2. For each sub-interval `(lowerᵢ, upperᵢ)`, where `upperᵢ` is `lowerᵢ +</a>
<a id="689" class="Comment">--      step`, we pick the line segment `fᵢ(x) = mᵢ * x + bᵢ`, with slope `mᵢ`</a>
<a id="768" class="Comment">--      and y-intercept `bᵢ`, from `(lowerᵢ, f(lowerᵢ))` to `(upperᵢ, f(upperᵢ))`.</a>
<a id="851" class="Comment">--   3. Finally, we connect all line segments `fᵢ`. The result is a piecewise-</a>
<a id="930" class="Comment">--      linear approximation for `f` over the interval `(lower, upper)`.</a>
<a id="1003" class="Comment">--</a>
<a id="1006" class="Comment">-- The number of segments determines the granularity of the approximation,</a>
<a id="1081" class="Comment">-- though the approximations do not necessarily becomes less precise with an</a>
<a id="1158" class="Comment">-- increased number of segments: e.g., for the exponential function and tanh,</a>
<a id="1236" class="Comment">-- we observe that approximations which use an odd number `pieces` outperform</a>
<a id="1314" class="Comment">-- approximations which use `pieces + 1` segments.</a>
<a id="1365" class="Comment">--</a>
<a id="1368" class="Comment">-- Exports:</a>
<a id="1380" class="Comment">--</a>
<a id="1383" class="Comment">--   - LineSegment (slope; intercept)</a>
<a id="1421" class="Comment">--   - PiecewiseLinear ([]; _∷_)</a>
<a id="1454" class="Comment">--   - linearise</a>
<a id="1471" class="Comment">--</a>
<a id="1474" class="Comment">-- NOTE: The module also exports the following definitions, but these should be</a>
<a id="1554" class="Comment">--       considered &quot;package private&quot;, and should not be relied upon.</a>
<a id="1624" class="Comment">--</a>
<a id="1627" class="Comment">--   - head</a>
<a id="1639" class="Comment">--   - _+[_*_]</a>
<a id="1654" class="Comment">--   - last</a>
<a id="1666" class="Comment">--</a>
<a id="1669" class="Comment">--------------------------------------------------------------------------------</a>
<a id="1750" class="Keyword">module</a> <a id="1757" href="Amethyst.PiecewiseLinear.Base.html" class="Module">Amethyst.PiecewiseLinear.Base</a> <a id="1787" class="Keyword">where</a>

<a id="1794" class="Keyword">open</a> <a id="1799" class="Keyword">import</a> <a id="1806" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="1816" class="Symbol">as</a> <a id="1819" class="Module">Bool</a> <a id="1824" class="Keyword">using</a> <a id="1830" class="Symbol">(</a><a id="1831" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a><a id="1835" class="Symbol">;</a> <a id="1837" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a><a id="1841" class="Symbol">;</a> <a id="1843" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a><a id="1848" class="Symbol">;</a> <a id="1850" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="1863" class="Symbol">)</a>
<a id="1865" class="Keyword">open</a> <a id="1870" class="Keyword">import</a> <a id="1877" href="Data.Float.html" class="Module">Data.Float</a> <a id="1888" class="Symbol">as</a> <a id="1891" class="Module">Float</a> <a id="1897" class="Keyword">using</a> <a id="1903" class="Symbol">(</a><a id="1904" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="1909" class="Symbol">;</a> <a id="1911" href="Agda.Builtin.Float.html#1336" class="Primitive">_+_</a><a id="1914" class="Symbol">;</a> <a id="1916" href="Agda.Builtin.Float.html#1389" class="Primitive">_-_</a><a id="1919" class="Symbol">;</a> <a id="1921" href="Agda.Builtin.Float.html#1442" class="Primitive">_*_</a><a id="1924" class="Symbol">;</a> <a id="1926" href="Agda.Builtin.Float.html#1495" class="Primitive">_÷_</a><a id="1929" class="Symbol">;</a> <a id="1931" href="Agda.Builtin.Float.html#422" class="Primitive">_≤ᵇ_</a><a id="1935" class="Symbol">)</a>
<a id="1937" class="Keyword">open</a> <a id="1942" class="Keyword">import</a> <a id="1949" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="1958" class="Symbol">as</a> <a id="1961" class="Module">Nat</a> <a id="1965" class="Keyword">using</a> <a id="1971" class="Symbol">(</a><a id="1972" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="1973" class="Symbol">;</a> <a id="1975" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a><a id="1978" class="Symbol">;</a> <a id="1980" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="1984" class="Symbol">)</a>
<a id="1986" class="Keyword">open</a> <a id="1991" class="Keyword">import</a> <a id="1998" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="2007" class="Symbol">as</a> <a id="2010" class="Module">Vec</a> <a id="2014" class="Keyword">using</a> <a id="2020" class="Symbol">(</a><a id="2021" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="2024" class="Symbol">)</a>

<a id="2027" class="Keyword">private</a>
  <a id="2037" class="Keyword">variable</a>
    <a id="2050" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a> <a id="2057" class="Symbol">:</a> <a id="2059" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="2065" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a>  <a id="2072" class="Symbol">:</a> <a id="2074" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
    <a id="2084" href="Amethyst.PiecewiseLinear.Base.html#2084" class="Generalizable">step</a>   <a id="2091" class="Symbol">:</a> <a id="2093" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
    <a id="2103" href="Amethyst.PiecewiseLinear.Base.html#2103" class="Generalizable">upper</a>  <a id="2110" class="Symbol">:</a> <a id="2112" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>

<a id="2119" class="Comment">-- |A line segment is defined by a lower and upper bound on the x-values, a slope,</a>
<a id="2202" class="Comment">--  and and intercept.</a>
<a id="2225" class="Keyword">record</a> <a id="LineSegment"></a><a id="2232" href="Amethyst.PiecewiseLinear.Base.html#2232" class="Record">LineSegment</a> <a id="2244" class="Symbol">(</a><a id="2245" href="Amethyst.PiecewiseLinear.Base.html#2245" class="Bound">lower</a> <a id="2251" href="Amethyst.PiecewiseLinear.Base.html#2251" class="Bound">upper</a> <a id="2257" class="Symbol">:</a> <a id="2259" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="2264" class="Symbol">)</a> <a id="2266" class="Symbol">:</a> <a id="2268" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2272" class="Keyword">where</a>
  <a id="2280" class="Keyword">field</a>
    <a id="LineSegment.slope"></a><a id="2290" href="Amethyst.PiecewiseLinear.Base.html#2290" class="Field">slope</a>     <a id="2300" class="Symbol">:</a> <a id="2302" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
    <a id="LineSegment.intercept"></a><a id="2312" href="Amethyst.PiecewiseLinear.Base.html#2312" class="Field">intercept</a> <a id="2322" class="Symbol">:</a> <a id="2324" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>

<a id="2331" class="Comment">-- |A piecewise-linear function is a sequence of line segments.</a>
<a id="2395" class="Keyword">data</a> <a id="PiecewiseLinear"></a><a id="2400" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="2416" class="Symbol">(</a><a id="2417" href="Amethyst.PiecewiseLinear.Base.html#2417" class="Bound">lower</a> <a id="2423" href="Amethyst.PiecewiseLinear.Base.html#2423" class="Bound">step</a> <a id="2428" class="Symbol">:</a> <a id="2430" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="2435" class="Symbol">)</a> <a id="2437" class="Symbol">:</a> <a id="2439" class="Symbol">(</a><a id="2440" href="Amethyst.PiecewiseLinear.Base.html#2440" class="Bound">pieces</a> <a id="2447" class="Symbol">:</a> <a id="2449" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="2450" class="Symbol">)</a> <a id="2452" class="Symbol">→</a> <a id="2454" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2458" class="Keyword">where</a>
  <a id="PiecewiseLinear.[]"></a><a id="2466" href="Amethyst.PiecewiseLinear.Base.html#2466" class="InductiveConstructor">[]</a>  <a id="2470" class="Symbol">:</a> <a id="2472" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="2488" href="Amethyst.PiecewiseLinear.Base.html#2417" class="Bound">lower</a> <a id="2494" href="Amethyst.PiecewiseLinear.Base.html#2423" class="Bound">step</a> <a id="2499" class="Number">0</a>
  <a id="PiecewiseLinear._∷_"></a><a id="2503" href="Amethyst.PiecewiseLinear.Base.html#2503" class="InductiveConstructor Operator">_∷_</a> <a id="2507" class="Symbol">:</a> <a id="2509" class="Symbol">(</a><a id="2510" href="Amethyst.PiecewiseLinear.Base.html#2510" class="Bound">ls</a> <a id="2513" class="Symbol">:</a> <a id="2515" href="Amethyst.PiecewiseLinear.Base.html#2232" class="Record">LineSegment</a> <a id="2527" href="Amethyst.PiecewiseLinear.Base.html#2417" class="Bound">lower</a> <a id="2533" class="Symbol">(</a><a id="2534" href="Amethyst.PiecewiseLinear.Base.html#2417" class="Bound">lower</a> <a id="2540" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="2542" href="Amethyst.PiecewiseLinear.Base.html#2423" class="Bound">step</a><a id="2546" class="Symbol">))</a>
      <a id="2555" class="Symbol">→</a> <a id="2557" class="Symbol">(</a><a id="2558" href="Amethyst.PiecewiseLinear.Base.html#2558" class="Bound">pl</a> <a id="2561" class="Symbol">:</a> <a id="2563" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="2579" class="Symbol">(</a><a id="2580" href="Amethyst.PiecewiseLinear.Base.html#2417" class="Bound">lower</a> <a id="2586" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="2588" href="Amethyst.PiecewiseLinear.Base.html#2423" class="Bound">step</a><a id="2592" class="Symbol">)</a> <a id="2594" href="Amethyst.PiecewiseLinear.Base.html#2423" class="Bound">step</a> <a id="2599" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a><a id="2605" class="Symbol">)</a>
      <a id="2613" class="Symbol">→</a> <a id="2615" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="2631" href="Amethyst.PiecewiseLinear.Base.html#2417" class="Bound">lower</a> <a id="2637" href="Amethyst.PiecewiseLinear.Base.html#2423" class="Bound">step</a> <a id="2642" class="Symbol">(</a><a id="2643" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="2647" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a><a id="2653" class="Symbol">)</a>

<a id="2656" class="Comment">-- |Return the first line segment in a piecewise-linear function.</a>
<a id="head"></a><a id="2722" href="Amethyst.PiecewiseLinear.Base.html#2722" class="Function">head</a> <a id="2727" class="Symbol">:</a> <a id="2729" class="Symbol">(</a><a id="2730" href="Amethyst.PiecewiseLinear.Base.html#2730" class="Bound">pl</a> <a id="2733" class="Symbol">:</a> <a id="2735" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="2751" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a> <a id="2757" href="Amethyst.PiecewiseLinear.Base.html#2084" class="Generalizable">step</a> <a id="2762" class="Symbol">(</a><a id="2763" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="2767" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a><a id="2773" class="Symbol">))</a>
     <a id="2781" class="Symbol">→</a> <a id="2783" href="Amethyst.PiecewiseLinear.Base.html#2232" class="Record">LineSegment</a> <a id="2795" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a> <a id="2801" class="Symbol">(</a><a id="2802" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a> <a id="2808" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="2810" href="Amethyst.PiecewiseLinear.Base.html#2084" class="Generalizable">step</a><a id="2814" class="Symbol">)</a>
<a id="2816" href="Amethyst.PiecewiseLinear.Base.html#2722" class="Function">head</a> <a id="2821" class="Symbol">(</a><a id="2822" href="Amethyst.PiecewiseLinear.Base.html#2822" class="Bound">l</a> <a id="2824" href="Amethyst.PiecewiseLinear.Base.html#2503" class="InductiveConstructor Operator">∷</a> <a id="2826" href="Amethyst.PiecewiseLinear.Base.html#2826" class="Bound">ls</a><a id="2828" class="Symbol">)</a> <a id="2830" class="Symbol">=</a> <a id="2832" href="Amethyst.PiecewiseLinear.Base.html#2822" class="Bound">l</a>

<a id="2835" class="Comment">-- |Repeated addition of floating-point numbers, by recursion on a natural number.</a>
<a id="2918" class="Comment">--</a>
<a id="2921" class="Comment">--  NOTE: The reason this is done by recusion on the natural `z`, instead of by just</a>
<a id="3006" class="Comment">--        evaluating the floating-point expression, is that (at the time of writing)</a>
<a id="3091" class="Comment">--        it&#39;s not possible to prove properties about floating-point arithmetic in</a>
<a id="3174" class="Comment">--        Agda. By recursing on a natural, we can construct exactly the structure</a>
<a id="3256" class="Comment">--        that arises from the PiecewiseLinear construction.</a>
<a id="3317" class="Comment">--</a>
<a id="_+[_*_]"></a><a id="3320" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">_+[_*_]</a> <a id="3328" class="Symbol">:</a> <a id="3330" class="Symbol">(</a><a id="3331" href="Amethyst.PiecewiseLinear.Base.html#3331" class="Bound">x</a> <a id="3333" href="Amethyst.PiecewiseLinear.Base.html#3333" class="Bound">y</a> <a id="3335" class="Symbol">:</a> <a id="3337" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="3342" class="Symbol">)</a> <a id="3344" class="Symbol">(</a><a id="3345" href="Amethyst.PiecewiseLinear.Base.html#3345" class="Bound">z</a> <a id="3347" class="Symbol">:</a> <a id="3349" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="3350" class="Symbol">)</a> <a id="3352" class="Symbol">→</a> <a id="3354" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a>
<a id="3360" href="Amethyst.PiecewiseLinear.Base.html#3360" class="Bound">x</a> <a id="3362" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">+[</a> <a id="3365" href="Amethyst.PiecewiseLinear.Base.html#3365" class="Bound">y</a> <a id="3367" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">*</a> <a id="3369" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>  <a id="3375" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">]</a> <a id="3377" class="Symbol">=</a> <a id="3379" href="Amethyst.PiecewiseLinear.Base.html#3360" class="Bound">x</a>
<a id="3381" href="Amethyst.PiecewiseLinear.Base.html#3381" class="Bound">x</a> <a id="3383" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">+[</a> <a id="3386" href="Amethyst.PiecewiseLinear.Base.html#3386" class="Bound">y</a> <a id="3388" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">*</a> <a id="3390" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3394" href="Amethyst.PiecewiseLinear.Base.html#3394" class="Bound">z</a> <a id="3396" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">]</a> <a id="3398" class="Symbol">=</a> <a id="3400" class="Symbol">(</a><a id="3401" href="Amethyst.PiecewiseLinear.Base.html#3381" class="Bound">x</a> <a id="3403" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="3405" href="Amethyst.PiecewiseLinear.Base.html#3386" class="Bound">y</a><a id="3406" class="Symbol">)</a> <a id="3408" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">+[</a> <a id="3411" href="Amethyst.PiecewiseLinear.Base.html#3386" class="Bound">y</a> <a id="3413" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">*</a> <a id="3415" href="Amethyst.PiecewiseLinear.Base.html#3394" class="Bound">z</a> <a id="3417" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">]</a>

<a id="3420" class="Comment">-- |Return the last line segment in a piecewise-linear function.</a>
<a id="last"></a><a id="3485" href="Amethyst.PiecewiseLinear.Base.html#3485" class="Function">last</a> <a id="3490" class="Symbol">:</a> <a id="3492" class="Symbol">(</a><a id="3493" href="Amethyst.PiecewiseLinear.Base.html#3493" class="Bound">pl</a> <a id="3496" class="Symbol">:</a> <a id="3498" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="3514" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a> <a id="3520" href="Amethyst.PiecewiseLinear.Base.html#2084" class="Generalizable">step</a> <a id="3525" class="Symbol">(</a><a id="3526" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3530" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a><a id="3536" class="Symbol">))</a>
     <a id="3544" class="Symbol">→</a> <a id="3546" href="Amethyst.PiecewiseLinear.Base.html#2232" class="Record">LineSegment</a> <a id="3558" class="Symbol">(</a><a id="3559" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a> <a id="3565" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">+[</a> <a id="3568" href="Amethyst.PiecewiseLinear.Base.html#2084" class="Generalizable">step</a> <a id="3573" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">*</a> <a id="3575" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a> <a id="3582" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">]</a><a id="3583" class="Symbol">)</a> <a id="3585" class="Symbol">(</a><a id="3586" href="Amethyst.PiecewiseLinear.Base.html#2065" class="Generalizable">lower</a> <a id="3592" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">+[</a> <a id="3595" href="Amethyst.PiecewiseLinear.Base.html#2084" class="Generalizable">step</a> <a id="3600" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">*</a> <a id="3602" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3606" href="Amethyst.PiecewiseLinear.Base.html#2050" class="Generalizable">pieces</a> <a id="3613" href="Amethyst.PiecewiseLinear.Base.html#3320" class="Function Operator">]</a><a id="3614" class="Symbol">)</a>
<a id="3616" href="Amethyst.PiecewiseLinear.Base.html#3485" class="Function">last</a> <a id="3621" class="Symbol">(</a><a id="3622" href="Amethyst.PiecewiseLinear.Base.html#3622" class="Bound">l</a> <a id="3624" href="Amethyst.PiecewiseLinear.Base.html#2503" class="InductiveConstructor Operator">∷</a> <a id="3626" href="Amethyst.PiecewiseLinear.Base.html#2466" class="InductiveConstructor">[]</a><a id="3628" class="Symbol">)</a>         <a id="3638" class="Symbol">=</a> <a id="3640" href="Amethyst.PiecewiseLinear.Base.html#3622" class="Bound">l</a>
<a id="3642" href="Amethyst.PiecewiseLinear.Base.html#3485" class="Function">last</a> <a id="3647" class="Symbol">(_</a> <a id="3650" href="Amethyst.PiecewiseLinear.Base.html#2503" class="InductiveConstructor Operator">∷</a> <a id="3652" href="Amethyst.PiecewiseLinear.Base.html#3652" class="Bound">ls</a><a id="3654" class="Symbol">@(_</a> <a id="3658" href="Amethyst.PiecewiseLinear.Base.html#2503" class="InductiveConstructor Operator">∷</a> <a id="3660" class="Symbol">_))</a> <a id="3664" class="Symbol">=</a> <a id="3666" href="Amethyst.PiecewiseLinear.Base.html#3485" class="Function">last</a> <a id="3671" href="Amethyst.PiecewiseLinear.Base.html#3652" class="Bound">ls</a>

<a id="3675" class="Keyword">private</a>
  <a id="3685" class="Comment">-- |Approximate the function f between lower and upper using one line segment.</a>
  <a id="lineSegment"></a><a id="3766" href="Amethyst.PiecewiseLinear.Base.html#3766" class="Function">lineSegment</a> <a id="3778" class="Symbol">:</a> <a id="3780" class="Symbol">(</a><a id="3781" href="Amethyst.PiecewiseLinear.Base.html#3781" class="Bound">f</a> <a id="3783" class="Symbol">:</a> <a id="3785" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="3791" class="Symbol">→</a> <a id="3793" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="3798" class="Symbol">)</a> <a id="3800" class="Symbol">(</a><a id="3801" href="Amethyst.PiecewiseLinear.Base.html#3801" class="Bound">lower</a> <a id="3807" href="Amethyst.PiecewiseLinear.Base.html#3807" class="Bound">step</a> <a id="3812" class="Symbol">:</a> <a id="3814" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="3819" class="Symbol">)</a> <a id="3821" class="Symbol">→</a> <a id="3823" href="Amethyst.PiecewiseLinear.Base.html#2232" class="Record">LineSegment</a> <a id="3835" href="Amethyst.PiecewiseLinear.Base.html#3801" class="Bound">lower</a> <a id="3841" class="Symbol">(</a><a id="3842" href="Amethyst.PiecewiseLinear.Base.html#3801" class="Bound">lower</a> <a id="3848" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="3850" href="Amethyst.PiecewiseLinear.Base.html#3807" class="Bound">step</a><a id="3854" class="Symbol">)</a>
  <a id="3858" href="Amethyst.PiecewiseLinear.Base.html#3766" class="Function">lineSegment</a> <a id="3870" href="Amethyst.PiecewiseLinear.Base.html#3870" class="Bound">f</a> <a id="3872" href="Amethyst.PiecewiseLinear.Base.html#3872" class="Bound">lower</a> <a id="3878" href="Amethyst.PiecewiseLinear.Base.html#3878" class="Bound">step</a> <a id="3883" class="Symbol">=</a>
    <a id="3889" class="Keyword">let</a> <a id="3893" href="Amethyst.PiecewiseLinear.Base.html#3893" class="Bound">upper</a>     <a id="3903" class="Symbol">=</a> <a id="3905" href="Amethyst.PiecewiseLinear.Base.html#3872" class="Bound">lower</a> <a id="3911" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="3913" href="Amethyst.PiecewiseLinear.Base.html#3878" class="Bound">step</a>
        <a id="3926" href="Amethyst.PiecewiseLinear.Base.html#3926" class="Bound">slope</a>     <a id="3936" class="Symbol">=</a> <a id="3938" class="Symbol">(</a><a id="3939" href="Amethyst.PiecewiseLinear.Base.html#3870" class="Bound">f</a> <a id="3941" href="Amethyst.PiecewiseLinear.Base.html#3893" class="Bound">upper</a> <a id="3947" href="Agda.Builtin.Float.html#1389" class="Primitive Operator">-</a> <a id="3949" href="Amethyst.PiecewiseLinear.Base.html#3870" class="Bound">f</a> <a id="3951" href="Amethyst.PiecewiseLinear.Base.html#3872" class="Bound">lower</a><a id="3956" class="Symbol">)</a> <a id="3958" href="Agda.Builtin.Float.html#1495" class="Primitive Operator">÷</a> <a id="3960" class="Symbol">(</a><a id="3961" href="Amethyst.PiecewiseLinear.Base.html#3893" class="Bound">upper</a> <a id="3967" href="Agda.Builtin.Float.html#1389" class="Primitive Operator">-</a> <a id="3969" href="Amethyst.PiecewiseLinear.Base.html#3872" class="Bound">lower</a><a id="3974" class="Symbol">)</a>
        <a id="3984" href="Amethyst.PiecewiseLinear.Base.html#3984" class="Bound">intercept</a> <a id="3994" class="Symbol">=</a> <a id="3996" href="Amethyst.PiecewiseLinear.Base.html#3870" class="Bound">f</a> <a id="3998" href="Amethyst.PiecewiseLinear.Base.html#3872" class="Bound">lower</a> <a id="4004" href="Agda.Builtin.Float.html#1389" class="Primitive Operator">-</a> <a id="4006" class="Symbol">(</a><a id="4007" href="Amethyst.PiecewiseLinear.Base.html#3926" class="Bound">slope</a> <a id="4013" href="Agda.Builtin.Float.html#1442" class="Primitive Operator">*</a> <a id="4015" href="Amethyst.PiecewiseLinear.Base.html#3872" class="Bound">lower</a><a id="4020" class="Symbol">)</a>
    <a id="4026" class="Keyword">in</a> <a id="4029" class="Keyword">record</a> <a id="4036" class="Symbol">{</a> <a id="4038" href="Amethyst.PiecewiseLinear.Base.html#2290" class="Field">slope</a> <a id="4044" class="Symbol">=</a> <a id="4046" href="Amethyst.PiecewiseLinear.Base.html#3926" class="Bound">slope</a> <a id="4052" class="Symbol">;</a> <a id="4054" href="Amethyst.PiecewiseLinear.Base.html#2312" class="Field">intercept</a> <a id="4064" class="Symbol">=</a> <a id="4066" href="Amethyst.PiecewiseLinear.Base.html#3984" class="Bound">intercept</a> <a id="4076" class="Symbol">}</a>

  <a id="4081" class="Comment">-- |Approximate the function f from lower, using pieces line segments of length step.</a>
  <a id="piecewiseLinear"></a><a id="4169" href="Amethyst.PiecewiseLinear.Base.html#4169" class="Function">piecewiseLinear</a> <a id="4185" class="Symbol">:</a> <a id="4187" class="Symbol">(</a><a id="4188" href="Amethyst.PiecewiseLinear.Base.html#4188" class="Bound">f</a> <a id="4190" class="Symbol">:</a> <a id="4192" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="4198" class="Symbol">→</a> <a id="4200" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="4205" class="Symbol">)</a> <a id="4207" class="Symbol">(</a><a id="4208" href="Amethyst.PiecewiseLinear.Base.html#4208" class="Bound">lower</a> <a id="4214" href="Amethyst.PiecewiseLinear.Base.html#4214" class="Bound">step</a> <a id="4219" class="Symbol">:</a> <a id="4221" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="4226" class="Symbol">)</a> <a id="4228" class="Symbol">(</a><a id="4229" href="Amethyst.PiecewiseLinear.Base.html#4229" class="Bound">pieces</a> <a id="4236" class="Symbol">:</a> <a id="4238" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="4239" class="Symbol">)</a> <a id="4241" class="Symbol">→</a> <a id="4243" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="4259" href="Amethyst.PiecewiseLinear.Base.html#4208" class="Bound">lower</a> <a id="4265" href="Amethyst.PiecewiseLinear.Base.html#4214" class="Bound">step</a> <a id="4270" href="Amethyst.PiecewiseLinear.Base.html#4229" class="Bound">pieces</a>
  <a id="4279" href="Amethyst.PiecewiseLinear.Base.html#4169" class="Function">piecewiseLinear</a> <a id="4295" href="Amethyst.PiecewiseLinear.Base.html#4295" class="Bound">f</a> <a id="4297" href="Amethyst.PiecewiseLinear.Base.html#4297" class="Bound">lower</a> <a id="4303" href="Amethyst.PiecewiseLinear.Base.html#4303" class="Bound">step</a> <a id="4308" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a> <a id="4313" class="Symbol">=</a> <a id="4315" href="Amethyst.PiecewiseLinear.Base.html#2466" class="InductiveConstructor">[]</a>
  <a id="4320" href="Amethyst.PiecewiseLinear.Base.html#4169" class="Function">piecewiseLinear</a> <a id="4336" href="Amethyst.PiecewiseLinear.Base.html#4336" class="Bound">f</a> <a id="4338" href="Amethyst.PiecewiseLinear.Base.html#4338" class="Bound">lower</a> <a id="4344" href="Amethyst.PiecewiseLinear.Base.html#4344" class="Bound">step</a> <a id="4349" class="Symbol">(</a><a id="4350" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="4354" href="Amethyst.PiecewiseLinear.Base.html#4354" class="Bound">pieces</a><a id="4360" class="Symbol">)</a> <a id="4362" class="Symbol">=</a> <a id="4364" href="Amethyst.PiecewiseLinear.Base.html#3766" class="Function">lineSegment</a> <a id="4376" href="Amethyst.PiecewiseLinear.Base.html#4336" class="Bound">f</a> <a id="4378" href="Amethyst.PiecewiseLinear.Base.html#4338" class="Bound">lower</a> <a id="4384" href="Amethyst.PiecewiseLinear.Base.html#4344" class="Bound">step</a> <a id="4389" href="Amethyst.PiecewiseLinear.Base.html#2503" class="InductiveConstructor Operator">∷</a> <a id="4391" href="Amethyst.PiecewiseLinear.Base.html#4169" class="Function">piecewiseLinear</a> <a id="4407" href="Amethyst.PiecewiseLinear.Base.html#4336" class="Bound">f</a> <a id="4409" class="Symbol">(</a><a id="4410" href="Amethyst.PiecewiseLinear.Base.html#4338" class="Bound">lower</a> <a id="4416" href="Agda.Builtin.Float.html#1336" class="Primitive Operator">+</a> <a id="4418" href="Amethyst.PiecewiseLinear.Base.html#4344" class="Bound">step</a><a id="4422" class="Symbol">)</a> <a id="4424" href="Amethyst.PiecewiseLinear.Base.html#4344" class="Bound">step</a> <a id="4429" href="Amethyst.PiecewiseLinear.Base.html#4354" class="Bound">pieces</a>

<a id="4437" class="Comment">-- |Approximate the function f between lower and upper using pieces line segments.</a>
<a id="linearise"></a><a id="4520" href="Amethyst.PiecewiseLinear.Base.html#4520" class="Function">linearise</a> <a id="4530" class="Symbol">:</a> <a id="4532" class="Symbol">(</a><a id="4533" href="Amethyst.PiecewiseLinear.Base.html#4533" class="Bound">f</a> <a id="4535" class="Symbol">:</a> <a id="4537" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a> <a id="4543" class="Symbol">→</a> <a id="4545" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="4550" class="Symbol">)</a> <a id="4552" class="Symbol">(</a><a id="4553" href="Amethyst.PiecewiseLinear.Base.html#4553" class="Bound">lower</a> <a id="4559" href="Amethyst.PiecewiseLinear.Base.html#4559" class="Bound">upper</a> <a id="4565" class="Symbol">:</a> <a id="4567" href="Agda.Builtin.Float.html#354" class="Postulate">Float</a><a id="4572" class="Symbol">)</a> <a id="4574" class="Symbol">(</a><a id="4575" href="Amethyst.PiecewiseLinear.Base.html#4575" class="Bound">pieces</a> <a id="4582" class="Symbol">:</a> <a id="4584" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="4585" class="Symbol">)</a>
          <a id="4597" class="Symbol">→</a> <a id="4599" href="Amethyst.PiecewiseLinear.Base.html#2400" class="Datatype">PiecewiseLinear</a> <a id="4615" href="Amethyst.PiecewiseLinear.Base.html#4553" class="Bound">lower</a> <a id="4621" class="Symbol">((</a><a id="4623" href="Amethyst.PiecewiseLinear.Base.html#4559" class="Bound">upper</a> <a id="4629" href="Agda.Builtin.Float.html#1389" class="Primitive Operator">-</a> <a id="4631" href="Amethyst.PiecewiseLinear.Base.html#4553" class="Bound">lower</a><a id="4636" class="Symbol">)</a> <a id="4638" href="Agda.Builtin.Float.html#1495" class="Primitive Operator">÷</a> <a id="4640" href="Agda.Builtin.Float.html#817" class="Primitive">Float.fromℕ</a> <a id="4652" href="Amethyst.PiecewiseLinear.Base.html#4575" class="Bound">pieces</a><a id="4658" class="Symbol">)</a> <a id="4660" href="Amethyst.PiecewiseLinear.Base.html#4575" class="Bound">pieces</a>
<a id="4667" href="Amethyst.PiecewiseLinear.Base.html#4520" class="Function">linearise</a> <a id="4677" href="Amethyst.PiecewiseLinear.Base.html#4677" class="Bound">f</a> <a id="4679" href="Amethyst.PiecewiseLinear.Base.html#4679" class="Bound">lower</a> <a id="4685" href="Amethyst.PiecewiseLinear.Base.html#4685" class="Bound">upper</a> <a id="4691" href="Amethyst.PiecewiseLinear.Base.html#4691" class="Bound">pieces</a> <a id="4698" class="Symbol">=</a> <a id="4700" href="Amethyst.PiecewiseLinear.Base.html#4169" class="Function">piecewiseLinear</a> <a id="4716" href="Amethyst.PiecewiseLinear.Base.html#4677" class="Bound">f</a> <a id="4718" href="Amethyst.PiecewiseLinear.Base.html#4679" class="Bound">lower</a> <a id="4724" class="Symbol">((</a><a id="4726" href="Amethyst.PiecewiseLinear.Base.html#4685" class="Bound">upper</a> <a id="4732" href="Agda.Builtin.Float.html#1389" class="Primitive Operator">-</a> <a id="4734" href="Amethyst.PiecewiseLinear.Base.html#4679" class="Bound">lower</a><a id="4739" class="Symbol">)</a> <a id="4741" href="Agda.Builtin.Float.html#1495" class="Primitive Operator">÷</a> <a id="4743" href="Agda.Builtin.Float.html#817" class="Primitive">Float.fromℕ</a> <a id="4755" href="Amethyst.PiecewiseLinear.Base.html#4691" class="Bound">pieces</a><a id="4761" class="Symbol">)</a> <a id="4763" href="Amethyst.PiecewiseLinear.Base.html#4691" class="Bound">pieces</a>

<a id="4771" class="Comment">-- -}</a>
<a id="4777" class="Comment">-- -}</a>
<a id="4783" class="Comment">-- -}</a>
<a id="4789" class="Comment">-- -}</a>
<a id="4795" class="Comment">-- -}</a>
</pre></body></html>