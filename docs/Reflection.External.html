<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Reflection.External</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Support for system calls as part of reflection</a>
<a id="156" class="Comment">------------------------------------------------------------------------</a>

<a id="230" class="Symbol">{-#</a> <a id="234" class="Keyword">OPTIONS</a> <a id="242" class="Pragma">--without-K</a> <a id="254" class="Pragma">--safe</a> <a id="261" class="Symbol">#-}</a>

<a id="266" class="Keyword">module</a> <a id="273" href="Reflection.External.html" class="Module">Reflection.External</a> <a id="293" class="Keyword">where</a>

<a id="300" class="Keyword">import</a> <a id="307" href="Agda.Builtin.Reflection.External.html" class="Module">Agda.Builtin.Reflection.External</a> <a id="340" class="Symbol">as</a> <a id="343" class="Module">Builtin</a>

<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="386" class="Symbol">;</a> <a id="388" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a><a id="391" class="Symbol">;</a> <a id="393" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="397" class="Symbol">;</a> <a id="399" href="Data.Nat.Base.html#2470" class="Function">NonZero</a><a id="406" class="Symbol">)</a>
<a id="408" class="Keyword">open</a> <a id="413" class="Keyword">import</a> <a id="420" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="435" class="Keyword">using</a> <a id="441" class="Symbol">(</a><a id="442" href="Agda.Builtin.List.html#148" class="Datatype">List</a><a id="446" class="Symbol">;</a> <a id="448" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a><a id="451" class="Symbol">;</a> <a id="453" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="455" class="Symbol">)</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Data.Product.html" class="Module">Data.Product</a> <a id="482" class="Keyword">using</a> <a id="488" class="Symbol">(</a><a id="489" href="Data.Product.html#1167" class="Function Operator">_×_</a><a id="492" class="Symbol">;</a> <a id="494" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="497" class="Symbol">)</a>
<a id="499" class="Keyword">open</a> <a id="504" class="Keyword">import</a> <a id="511" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="528" class="Symbol">as</a> <a id="531" class="Module">String</a> <a id="538" class="Keyword">using</a> <a id="544" class="Symbol">(</a><a id="545" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="551" class="Symbol">;</a> <a id="553" href="Data.String.Base.html#2177" class="Function Operator">_++_</a><a id="557" class="Symbol">)</a>
<a id="559" class="Keyword">open</a> <a id="564" class="Keyword">import</a> <a id="571" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="580" class="Keyword">using</a> <a id="586" class="Symbol">(</a><a id="587" href="Data.Sum.Base.html#734" class="Datatype Operator">_⊎_</a><a id="590" class="Symbol">;</a> <a id="592" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a><a id="596" class="Symbol">;</a> <a id="598" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a><a id="602" class="Symbol">;</a> <a id="604" href="Data.Sum.Base.html#920" class="Function Operator">[_,_]</a><a id="609" class="Symbol">)</a>
<a id="611" class="Keyword">open</a> <a id="616" class="Keyword">import</a> <a id="623" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="638" class="Keyword">using</a> <a id="644" class="Symbol">(</a><a id="645" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="646" class="Symbol">;</a> <a id="648" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="650" class="Symbol">)</a>
<a id="652" class="Keyword">open</a> <a id="657" class="Keyword">import</a> <a id="664" href="Function.html" class="Module">Function</a> <a id="673" class="Keyword">using</a> <a id="679" class="Symbol">(</a><a id="680" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="688" class="Symbol">;</a> <a id="690" href="Function.Base.html#1919" class="Function Operator">_$_</a><a id="693" class="Symbol">;</a> <a id="695" href="Function.Base.html#1031" class="Function Operator">_∘_</a><a id="698" class="Symbol">)</a>
<a id="700" class="Keyword">open</a> <a id="705" class="Keyword">import</a> <a id="712" href="Reflection.html" class="Module">Reflection</a> <a id="723" class="Keyword">hiding</a> <a id="730" class="Symbol">(</a><a id="731" href="Agda.Builtin.Reflection.html#3842" class="InductiveConstructor">name</a><a id="735" class="Symbol">)</a>

<a id="738" class="Comment">-- Type aliases for the various strings.</a>

<a id="CmdName"></a><a id="780" href="Reflection.External.html#780" class="Function">CmdName</a> <a id="788" class="Symbol">=</a> <a id="790" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="StdIn"></a><a id="797" href="Reflection.External.html#797" class="Function">StdIn</a>   <a id="805" class="Symbol">=</a> <a id="807" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="StdErr"></a><a id="814" href="Reflection.External.html#814" class="Function">StdErr</a>  <a id="822" class="Symbol">=</a> <a id="824" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="StdOut"></a><a id="831" href="Reflection.External.html#831" class="Function">StdOut</a>  <a id="839" class="Symbol">=</a> <a id="841" href="Agda.Builtin.String.html#336" class="Postulate">String</a>

<a id="849" class="Comment">-- Representation for exit codes, assuming 0 is consistently used to indicate</a>
<a id="927" class="Comment">-- success across platforms.</a>
<a id="956" class="Keyword">data</a> <a id="ExitCode"></a><a id="961" href="Reflection.External.html#961" class="Datatype">ExitCode</a> <a id="970" class="Symbol">:</a> <a id="972" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="976" class="Keyword">where</a>
  <a id="ExitCode.exitSuccess"></a><a id="984" href="Reflection.External.html#984" class="InductiveConstructor">exitSuccess</a> <a id="996" class="Symbol">:</a> <a id="998" href="Reflection.External.html#961" class="Datatype">ExitCode</a>
  <a id="ExitCode.exitFailure"></a><a id="1009" href="Reflection.External.html#1009" class="InductiveConstructor">exitFailure</a> <a id="1021" class="Symbol">:</a> <a id="1023" class="Symbol">(</a><a id="1024" href="Reflection.External.html#1024" class="Bound">n</a> <a id="1026" class="Symbol">:</a> <a id="1028" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="1029" class="Symbol">)</a> <a id="1031" class="Symbol">{</a><a id="1032" href="Reflection.External.html#1032" class="Bound">n≢0</a> <a id="1036" class="Symbol">:</a> <a id="1038" href="Data.Nat.Base.html#2470" class="Function">NonZero</a> <a id="1046" href="Reflection.External.html#1024" class="Bound">n</a><a id="1047" class="Symbol">}</a> <a id="1049" class="Symbol">→</a> <a id="1051" href="Reflection.External.html#961" class="Datatype">ExitCode</a>

<a id="1061" class="Comment">-- Specification for a command.</a>
<a id="1093" class="Keyword">record</a> <a id="CmdSpec"></a><a id="1100" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="1108" class="Symbol">:</a> <a id="1110" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1114" class="Keyword">where</a>
  <a id="1122" class="Keyword">constructor</a> <a id="cmdSpec"></a><a id="1134" href="Reflection.External.html#1134" class="InductiveConstructor">cmdSpec</a>
  <a id="1144" class="Keyword">field</a>
    <a id="CmdSpec.name"></a><a id="1154" href="Reflection.External.html#1154" class="Field">name</a>  <a id="1160" class="Symbol">:</a> <a id="1162" href="Reflection.External.html#780" class="Function">CmdName</a>     <a id="1174" class="Comment">-- ^ Executable name (see ~/.agda/executables)</a>
    <a id="CmdSpec.args"></a><a id="1225" href="Reflection.External.html#1225" class="Field">args</a>  <a id="1231" class="Symbol">:</a> <a id="1233" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1238" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="1245" class="Comment">-- ^ Command-line arguments for executable</a>
    <a id="CmdSpec.input"></a><a id="1292" href="Reflection.External.html#1292" class="Field">input</a> <a id="1298" class="Symbol">:</a> <a id="1300" href="Reflection.External.html#797" class="Function">StdIn</a>       <a id="1312" class="Comment">-- ^ Contents of standard input</a>

<a id="1345" class="Comment">-- Result of running a command.</a>
<a id="1377" class="Keyword">record</a> <a id="Result"></a><a id="1384" href="Reflection.External.html#1384" class="Record">Result</a> <a id="1391" class="Symbol">:</a> <a id="1393" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1397" class="Keyword">where</a>
  <a id="1405" class="Keyword">constructor</a> <a id="result"></a><a id="1417" href="Reflection.External.html#1417" class="InductiveConstructor">result</a>
  <a id="1426" class="Keyword">field</a>
    <a id="Result.exitCode"></a><a id="1436" href="Reflection.External.html#1436" class="Field">exitCode</a> <a id="1445" class="Symbol">:</a> <a id="1447" href="Reflection.External.html#961" class="Datatype">ExitCode</a> <a id="1456" class="Comment">-- ^ Exit code returned by the process</a>
    <a id="Result.output"></a><a id="1499" href="Reflection.External.html#1499" class="Field">output</a>   <a id="1508" class="Symbol">:</a> <a id="1510" href="Reflection.External.html#831" class="Function">StdOut</a>   <a id="1519" class="Comment">-- ^ Contents of standard output</a>
    <a id="Result.error"></a><a id="1556" href="Reflection.External.html#1556" class="Field">error</a>    <a id="1565" class="Symbol">:</a> <a id="1567" href="Reflection.External.html#814" class="Function">StdErr</a>   <a id="1576" class="Comment">-- ^ Contents of standard error</a>

<a id="1609" class="Comment">-- Convert a natural number to an exit code.</a>
<a id="toExitCode"></a><a id="1654" href="Reflection.External.html#1654" class="Function">toExitCode</a> <a id="1665" class="Symbol">:</a> <a id="1667" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1669" class="Symbol">→</a> <a id="1671" href="Reflection.External.html#961" class="Datatype">ExitCode</a>
<a id="1680" href="Reflection.External.html#1654" class="Function">toExitCode</a> <a id="1691" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>    <a id="1699" class="Symbol">=</a> <a id="1701" href="Reflection.External.html#984" class="InductiveConstructor">exitSuccess</a>
<a id="1713" href="Reflection.External.html#1654" class="Function">toExitCode</a> <a id="1724" class="Symbol">(</a><a id="1725" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1729" href="Reflection.External.html#1729" class="Bound">n</a><a id="1730" class="Symbol">)</a> <a id="1732" class="Symbol">=</a> <a id="1734" href="Reflection.External.html#1009" class="InductiveConstructor">exitFailure</a> <a id="1746" class="Symbol">(</a><a id="1747" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1751" href="Reflection.External.html#1729" class="Bound">n</a><a id="1752" class="Symbol">)</a>

<a id="1755" class="Comment">-- Quote an exit code as an Agda term.</a>
<a id="quoteExitCode"></a><a id="1794" href="Reflection.External.html#1794" class="Function">quoteExitCode</a> <a id="1808" class="Symbol">:</a> <a id="1810" href="Reflection.External.html#961" class="Datatype">ExitCode</a> <a id="1819" class="Symbol">→</a> <a id="1821" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a>
<a id="1826" href="Reflection.External.html#1794" class="Function">quoteExitCode</a> <a id="1840" href="Reflection.External.html#984" class="InductiveConstructor">exitSuccess</a> <a id="1852" class="Symbol">=</a>
  <a id="1856" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="1860" class="Symbol">(</a><a id="1861" class="Keyword">quote</a> <a id="1867" href="Reflection.External.html#984" class="InductiveConstructor">exitSuccess</a><a id="1878" class="Symbol">)</a> <a id="1880" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
<a id="1883" href="Reflection.External.html#1794" class="Function">quoteExitCode</a> <a id="1897" class="Symbol">(</a><a id="1898" href="Reflection.External.html#1009" class="InductiveConstructor">exitFailure</a> <a id="1910" href="Reflection.External.html#1910" class="Bound">n</a><a id="1911" class="Symbol">)</a> <a id="1913" class="Symbol">=</a>
  <a id="1917" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="1921" class="Symbol">(</a><a id="1922" class="Keyword">quote</a> <a id="1928" href="Reflection.External.html#1009" class="InductiveConstructor">exitFailure</a><a id="1939" class="Symbol">)</a> <a id="1941" class="Symbol">(</a><a id="1942" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="1947" class="Symbol">(</a><a id="1948" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="1952" class="Symbol">(</a><a id="1953" href="Agda.Builtin.Reflection.html#3672" class="InductiveConstructor">nat</a> <a id="1957" href="Reflection.External.html#1910" class="Bound">n</a><a id="1958" class="Symbol">))</a> <a id="1961" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1963" href="Reflection.Argument.html#1126" class="InductiveConstructor">hArg</a> <a id="1968" class="Symbol">(</a><a id="1969" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="1973" class="Symbol">(</a><a id="1974" class="Keyword">quote</a> <a id="1980" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="1982" class="Symbol">)</a> <a id="1984" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1986" class="Symbol">)</a> <a id="1988" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1990" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1992" class="Symbol">)</a>

<a id="1995" class="Comment">-- Quote a result as an Agda term.</a>
<a id="quoteResult"></a><a id="2030" href="Reflection.External.html#2030" class="Function">quoteResult</a> <a id="2042" class="Symbol">:</a> <a id="2044" href="Reflection.External.html#1384" class="Record">Result</a> <a id="2051" class="Symbol">→</a> <a id="2053" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a>
<a id="2058" href="Reflection.External.html#2030" class="Function">quoteResult</a> <a id="2070" class="Symbol">(</a><a id="2071" href="Reflection.External.html#1417" class="InductiveConstructor">result</a> <a id="2078" href="Reflection.External.html#2078" class="Bound">exitCode</a> <a id="2087" href="Reflection.External.html#2087" class="Bound">output</a> <a id="2094" href="Reflection.External.html#2094" class="Bound">error</a><a id="2099" class="Symbol">)</a> <a id="2101" class="Symbol">=</a>
  <a id="2105" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="2109" class="Symbol">(</a><a id="2110" class="Keyword">quote</a> <a id="2116" href="Reflection.External.html#1417" class="InductiveConstructor">result</a><a id="2122" class="Symbol">)</a> <a id="2124" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="2126" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2131" class="Symbol">(</a><a id="2132" href="Reflection.External.html#1794" class="Function">quoteExitCode</a> <a id="2146" href="Reflection.External.html#2078" class="Bound">exitCode</a><a id="2154" class="Symbol">)</a>
                     <a id="2177" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2179" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2184" class="Symbol">(</a><a id="2185" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="2189" class="Symbol">(</a><a id="2190" href="Agda.Builtin.Reflection.html#3808" class="InductiveConstructor">string</a> <a id="2197" href="Reflection.External.html#2087" class="Bound">output</a><a id="2203" class="Symbol">))</a>
                     <a id="2227" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2229" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2234" class="Symbol">(</a><a id="2235" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="2239" class="Symbol">(</a><a id="2240" href="Agda.Builtin.Reflection.html#3808" class="InductiveConstructor">string</a> <a id="2247" href="Reflection.External.html#2094" class="Bound">error</a><a id="2252" class="Symbol">))</a>
                     <a id="2276" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2278" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

<a id="2282" class="Comment">-- Run command from specification and return the full result.</a>
<a id="2344" class="Comment">--</a>
<a id="2347" class="Comment">-- NOTE: If the command fails, this macro still succeeds, and returns the</a>
<a id="2421" class="Comment">--       full result, including exit code and the contents of stderr.</a>
<a id="2491" class="Comment">--</a>
<a id="unsafeRunCmdTC"></a><a id="2494" href="Reflection.External.html#2494" class="Function">unsafeRunCmdTC</a> <a id="2509" class="Symbol">:</a> <a id="2511" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="2519" class="Symbol">→</a> <a id="2521" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="2524" href="Reflection.External.html#1384" class="Record">Result</a>
<a id="2531" href="Reflection.External.html#2494" class="Function">unsafeRunCmdTC</a> <a id="2546" href="Reflection.External.html#2546" class="Bound">c</a> <a id="2548" class="Symbol">=</a> <a id="2550" class="Keyword">do</a>
  <a id="2555" class="Symbol">(</a><a id="2556" href="Reflection.External.html#2556" class="Bound">exitCode</a> <a id="2565" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2567" class="Symbol">(</a><a id="2568" href="Reflection.External.html#2568" class="Bound">stdOut</a> <a id="2575" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2577" href="Reflection.External.html#2577" class="Bound">stdErr</a><a id="2583" class="Symbol">))</a>
    <a id="2590" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">←</a> <a id="2592" href="Agda.Builtin.Reflection.External.html#304" class="Postulate">Builtin.execTC</a> <a id="2607" class="Symbol">(</a><a id="2608" href="Reflection.External.html#1154" class="Field">CmdSpec.name</a> <a id="2621" href="Reflection.External.html#2546" class="Bound">c</a><a id="2622" class="Symbol">)</a> <a id="2624" class="Symbol">(</a><a id="2625" href="Reflection.External.html#1225" class="Field">CmdSpec.args</a> <a id="2638" href="Reflection.External.html#2546" class="Bound">c</a><a id="2639" class="Symbol">)</a> <a id="2641" class="Symbol">(</a><a id="2642" href="Reflection.External.html#1292" class="Field">CmdSpec.input</a> <a id="2656" href="Reflection.External.html#2546" class="Bound">c</a><a id="2657" class="Symbol">)</a>
  <a id="2661" href="Agda.Builtin.Reflection.html#7543" class="Postulate">return</a> <a id="2668" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="2670" href="Reflection.External.html#1417" class="InductiveConstructor">result</a> <a id="2677" class="Symbol">(</a><a id="2678" href="Reflection.External.html#1654" class="Function">toExitCode</a> <a id="2689" href="Reflection.External.html#2556" class="Bound">exitCode</a><a id="2697" class="Symbol">)</a> <a id="2699" href="Reflection.External.html#2568" class="Bound">stdOut</a> <a id="2706" href="Reflection.External.html#2577" class="Bound">stdErr</a>

<a id="2714" class="Keyword">macro</a>
  <a id="unsafeRunCmd"></a><a id="2722" href="Reflection.External.html#2722" class="Function">unsafeRunCmd</a> <a id="2735" class="Symbol">:</a> <a id="2737" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="2745" class="Symbol">→</a> <a id="2747" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a> <a id="2752" class="Symbol">→</a> <a id="2754" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="2757" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
  <a id="2761" href="Reflection.External.html#2722" class="Function">unsafeRunCmd</a> <a id="2774" href="Reflection.External.html#2774" class="Bound">c</a> <a id="2776" href="Reflection.External.html#2776" class="Bound">hole</a> <a id="2781" class="Symbol">=</a> <a id="2783" href="Reflection.External.html#2494" class="Function">unsafeRunCmdTC</a> <a id="2798" href="Reflection.External.html#2774" class="Bound">c</a> <a id="2800" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">&gt;&gt;=</a> <a id="2804" href="Agda.Builtin.Reflection.html#7673" class="Postulate">unify</a> <a id="2810" href="Reflection.External.html#2776" class="Bound">hole</a> <a id="2815" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="2817" href="Reflection.External.html#2030" class="Function">quoteResult</a>


<a id="2831" class="Comment">-- Show a command for the user.</a>
<a id="showCmdSpec"></a><a id="2863" href="Reflection.External.html#2863" class="Function">showCmdSpec</a> <a id="2875" class="Symbol">:</a> <a id="2877" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="2885" class="Symbol">→</a> <a id="2887" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="2894" href="Reflection.External.html#2863" class="Function">showCmdSpec</a> <a id="2906" href="Reflection.External.html#2906" class="Bound">c</a> <a id="2908" class="Symbol">=</a> <a id="2910" href="Data.String.Base.html#2805" class="Function">String.unwords</a> <a id="2925" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="2927" href="Reflection.External.html#1154" class="Field">CmdSpec.name</a> <a id="2940" href="Reflection.External.html#2906" class="Bound">c</a> <a id="2942" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2944" href="Reflection.External.html#1225" class="Field">CmdSpec.args</a> <a id="2957" href="Reflection.External.html#2906" class="Bound">c</a>


<a id="2961" class="Keyword">private</a>
  <a id="2971" class="Comment">-- Helper function for throwing an error from reflection.</a>
  <a id="userError"></a><a id="3031" href="Reflection.External.html#3031" class="Function">userError</a> <a id="3041" class="Symbol">:</a> <a id="3043" class="Symbol">∀</a> <a id="3045" class="Symbol">{</a><a id="3046" href="Reflection.External.html#3046" class="Bound">a</a><a id="3047" class="Symbol">}</a> <a id="3049" class="Symbol">{</a><a id="3050" href="Reflection.External.html#3050" class="Bound">A</a> <a id="3052" class="Symbol">:</a> <a id="3054" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3058" href="Reflection.External.html#3046" class="Bound">a</a><a id="3059" class="Symbol">}</a> <a id="3061" class="Symbol">→</a> <a id="3063" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="3071" class="Symbol">→</a> <a id="3073" href="Reflection.External.html#831" class="Function">StdOut</a> <a id="3080" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="3082" href="Reflection.External.html#814" class="Function">StdErr</a> <a id="3089" class="Symbol">→</a> <a id="3091" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="3094" href="Reflection.External.html#3050" class="Bound">A</a>
  <a id="3098" href="Reflection.External.html#3031" class="Function">userError</a> <a id="3108" href="Reflection.External.html#3108" class="Bound">c</a> <a id="3110" class="Symbol">(</a><a id="3111" href="Reflection.External.html#3111" class="Bound">stdout</a> <a id="3118" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3120" href="Reflection.External.html#3120" class="Bound">stderr</a><a id="3126" class="Symbol">)</a> <a id="3128" class="Symbol">=</a> <a id="3130" href="Agda.Builtin.Reflection.html#7713" class="Postulate">typeError</a> <a id="3140" class="Symbol">(</a><a id="3141" href="Agda.Builtin.Reflection.html#7199" class="InductiveConstructor">strErr</a> <a id="3148" href="Reflection.External.html#3177" class="Function">errMsg</a> <a id="3155" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3157" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3159" class="Symbol">)</a>
    <a id="3165" class="Keyword">where</a>
      <a id="3177" href="Reflection.External.html#3177" class="Function">errMsg</a> <a id="3184" class="Symbol">:</a> <a id="3186" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
      <a id="3199" href="Reflection.External.html#3177" class="Function">errMsg</a> <a id="3206" class="Symbol">=</a> <a id="3208" href="Data.String.Base.html#2550" class="Function">String.unlines</a>
             <a id="3236" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="3238" class="Symbol">(</a><a id="3239" class="String">&quot;Error while running command &#39;&quot;</a> <a id="3271" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3274" href="Reflection.External.html#2863" class="Function">showCmdSpec</a> <a id="3286" href="Reflection.External.html#3108" class="Bound">c</a> <a id="3288" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3291" class="String">&quot;&#39;&quot;</a><a id="3294" class="Symbol">)</a>
             <a id="3309" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3311" class="Symbol">(</a><a id="3312" class="String">&quot;Input:\n&quot;</a> <a id="3323" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3326" href="Reflection.External.html#1292" class="Field">CmdSpec.input</a> <a id="3340" href="Reflection.External.html#3108" class="Bound">c</a><a id="3341" class="Symbol">)</a>
             <a id="3356" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3358" class="Symbol">(</a><a id="3359" class="String">&quot;Output:\n&quot;</a> <a id="3371" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3374" href="Reflection.External.html#3111" class="Bound">stdout</a><a id="3380" class="Symbol">)</a>
             <a id="3395" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3397" class="Symbol">(</a><a id="3398" class="String">&quot;Error:\n&quot;</a> <a id="3409" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3412" href="Reflection.External.html#3120" class="Bound">stderr</a><a id="3418" class="Symbol">)</a>
             <a id="3433" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3435" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>


<a id="3440" class="Comment">-- Run command from specification. If the command succeeds, it returns the</a>
<a id="3515" class="Comment">-- contents of stdout. Otherwise, it throws a type error with the contents</a>
<a id="3590" class="Comment">-- of stderr.</a>
<a id="runCmdTC"></a><a id="3604" href="Reflection.External.html#3604" class="Function">runCmdTC</a> <a id="3613" class="Symbol">:</a> <a id="3615" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="3623" class="Symbol">→</a> <a id="3625" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="3628" href="Reflection.External.html#831" class="Function">StdOut</a>
<a id="3635" href="Reflection.External.html#3604" class="Function">runCmdTC</a> <a id="3644" href="Reflection.External.html#3644" class="Bound">c</a> <a id="3646" class="Symbol">=</a> <a id="3648" class="Keyword">do</a>
  <a id="3653" href="Reflection.External.html#3653" class="Bound">r</a> <a id="3655" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">←</a> <a id="3657" href="Reflection.External.html#2494" class="Function">unsafeRunCmdTC</a> <a id="3672" href="Reflection.External.html#3644" class="Bound">c</a>
  <a id="3676" class="Keyword">let</a> <a id="3680" href="Reflection.External.html#3680" class="Bound">debugPrefix</a> <a id="3692" class="Symbol">=</a> <a id="3694" class="Symbol">(</a><a id="3695" class="String">&quot;user.&quot;</a> <a id="3703" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3706" href="Reflection.External.html#1154" class="Field">CmdSpec.name</a> <a id="3719" href="Reflection.External.html#3644" class="Bound">c</a><a id="3720" class="Symbol">)</a>
  <a id="3724" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="3729" href="Reflection.External.html#1436" class="Field">Result.exitCode</a> <a id="3745" href="Reflection.External.html#3653" class="Bound">r</a> <a id="3747" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="3750" class="Symbol">λ</a>
    <a id="3756" class="Symbol">{</a> <a id="3758" href="Reflection.External.html#984" class="InductiveConstructor">exitSuccess</a> <a id="3770" class="Symbol">→</a> <a id="3772" class="Keyword">do</a>
      <a id="3781" href="Agda.Builtin.Reflection.html#9013" class="Postulate">debugPrint</a> <a id="3792" class="Symbol">(</a><a id="3793" href="Reflection.External.html#3680" class="Bound">debugPrefix</a> <a id="3805" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3808" class="String">&quot;.stderr&quot;</a><a id="3817" class="Symbol">)</a> <a id="3819" class="Number">10</a> <a id="3822" class="Symbol">(</a><a id="3823" href="Agda.Builtin.Reflection.html#7199" class="InductiveConstructor">strErr</a> <a id="3830" class="Symbol">(</a><a id="3831" href="Reflection.External.html#1556" class="Field">Result.error</a> <a id="3844" href="Reflection.External.html#3653" class="Bound">r</a><a id="3845" class="Symbol">)</a> <a id="3847" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3849" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3851" class="Symbol">)</a>
      <a id="3859" href="Agda.Builtin.Reflection.html#7543" class="Postulate">return</a> <a id="3866" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="3868" href="Reflection.External.html#1499" class="Field">Result.output</a> <a id="3882" href="Reflection.External.html#3653" class="Bound">r</a>
    <a id="3888" class="Symbol">;</a> <a id="3890" class="Symbol">(</a><a id="3891" href="Reflection.External.html#1009" class="InductiveConstructor">exitFailure</a> <a id="3903" href="Reflection.External.html#3903" class="Bound">n</a><a id="3904" class="Symbol">)</a> <a id="3906" class="Symbol">→</a> <a id="3908" class="Keyword">do</a>
      <a id="3917" href="Reflection.External.html#3031" class="Function">userError</a> <a id="3927" href="Reflection.External.html#3644" class="Bound">c</a> <a id="3929" class="Symbol">(</a><a id="3930" href="Reflection.External.html#1499" class="Field">Result.output</a> <a id="3944" href="Reflection.External.html#3653" class="Bound">r</a> <a id="3946" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3948" href="Reflection.External.html#1556" class="Field">Result.error</a> <a id="3961" href="Reflection.External.html#3653" class="Bound">r</a><a id="3962" class="Symbol">)</a>
    <a id="3968" class="Symbol">}</a>

<a id="3971" class="Keyword">macro</a>
  <a id="runCmd"></a><a id="3979" href="Reflection.External.html#3979" class="Function">runCmd</a> <a id="3986" class="Symbol">:</a> <a id="3988" href="Reflection.External.html#1100" class="Record">CmdSpec</a> <a id="3996" class="Symbol">→</a> <a id="3998" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a> <a id="4003" class="Symbol">→</a> <a id="4005" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="4008" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
  <a id="4012" href="Reflection.External.html#3979" class="Function">runCmd</a> <a id="4019" href="Reflection.External.html#4019" class="Bound">c</a> <a id="4021" href="Reflection.External.html#4021" class="Bound">hole</a> <a id="4026" class="Symbol">=</a> <a id="4028" href="Reflection.External.html#3604" class="Function">runCmdTC</a> <a id="4037" href="Reflection.External.html#4019" class="Bound">c</a> <a id="4039" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">&gt;&gt;=</a> <a id="4043" href="Agda.Builtin.Reflection.html#7673" class="Postulate">unify</a> <a id="4049" href="Reflection.External.html#4021" class="Bound">hole</a> <a id="4054" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="4056" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="4060" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="4062" href="Agda.Builtin.Reflection.html#3808" class="InductiveConstructor">string</a>
</pre></body></html>